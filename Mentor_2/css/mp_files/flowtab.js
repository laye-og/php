Flowtab=function(a){var b=this;b.dom,b.drawningboard=a,b.previewdialog,b.start=function(){b.drawningboard.api.loadTemplate("flowtab",function(a){b.dom=$(a),$("#drawningboard").append(b.dom),b.registerEvents(),b.drawningboard.formatsvg(b.dom)})},b.checkdisables=function(){b.drawningboard.currentstate>0?b.dom.find(".undo").removeClass("disabled"):b.dom.find(".undo").addClass("disabled"),b.drawningboard.currentstate<b.drawningboard.background.statelist.length-1?b.dom.find(".redo").removeClass("disabled"):b.dom.find(".redo").addClass("disabled")},b.pushstate=function(){$.each(b.drawningboard.cliplist,function(a,b){b.pushstate()}),b.drawningboard.background.pushstate(),b.drawningboard.currentstate++,b.checkdisables()},b.undo=function(){b.drawningboard.currentstate>0&&(b.drawningboard.currentstate--,b.drawningboard.selector.unselect(),$.each(b.drawningboard.cliplist,function(a,b){b.undo()}),b.drawningboard.background.undo(),b.drawningboard.selector.refreshindex(),b.drawningboard.contexttab.undo(),b.animation.undo()),b.checkdisables()},b.redo=function(){b.drawningboard.currentstate<b.drawningboard.background.statelist.length-1&&(b.drawningboard.currentstate++,b.drawningboard.selector.unselect(),$.each(b.drawningboard.cliplist,function(a,b){b.redo()}),b.drawningboard.background.redo(),b.drawningboard.selector.refreshindex(),b.drawningboard.contexttab.redo(),b.animation.redo()),b.checkdisables()},b.finish=function(){b.dom.remove()},b.reset=function(){var a=new Messagebox(b.drawningboard,b.drawningboard.api.dictionary.flowtab_reset_confirmation,b.resetCall,b.drawningboard.api.dictionary.reset,b.drawningboard.api.dictionary.cancel);a.show()},b.resetCall=function(){b.drawningboard.reset()},b.preview=function(){b.previewdialog=new Previewdialog(b.drawningboard),b.previewdialog.start(),b.animation.preview()},b.inputing=function(){var a=document.activeElement;return a&&("input"==a.tagName.toLowerCase()&&"text"==a.type||"textarea"==a.tagName.toLowerCase())?!0:!1},b.registerEvents=function(){if(b.drawningboard.isTouch)var a="touchstart";else var a="click";b.dom.find(".reset").on(a,function(a){a.preventDefault(),b.reset()}),b.dom.find(".undo").on(a,function(a){a.preventDefault(),b.undo()}),b.dom.find(".redo").on(a,function(a){a.preventDefault(),b.redo()}),b.dom.find(".preview").on(a,function(a){b.drawningboard.isSave=!0,a.preventDefault(),b.preview()}),$("body").keybind("keydown",{"C-z":function(a){b.inputing()||(a.preventDefault(),b.undo())},"C-y":function(a){b.inputing()||(a.preventDefault(),b.redo())},"C-a":function(a){b.inputing()||(a.preventDefault(),b.drawningboard.selector.selectall())},"M-a":function(a){b.inputing()||(a.preventDefault(),b.drawningboard.selector.selectall())},"S-z":function(a){b.inputing()||(a.preventDefault(),b.undo())},"S-y":function(a){b.inputing()||(a.preventDefault(),b.redo())},"S-a":function(a){b.inputing()||(a.preventDefault(),b.drawningboard.selector.selectall())},"return":function(){b.drawningboard.confirmmessage(),b.drawningboard.contexttab.fontliststate&&b.drawningboard.contexttab.fontenter()},up:function(){b.drawningboard.contexttab.fontliststate?b.drawningboard.contexttab.fontup():b.inputing()||b.drawningboard.selector.moveup(1)},down:function(){b.drawningboard.contexttab.fontliststate?b.drawningboard.contexttab.fontdown():b.inputing()||b.drawningboard.selector.movedown(1)},left:function(){b.inputing()||b.drawningboard.selector.moveleft(1)},right:function(){b.inputing()||b.drawningboard.selector.moveright(1)},"S-up":function(){b.inputing()||b.drawningboard.selector.moveup(10)},"S-down":function(){b.inputing()||b.drawningboard.selector.movedown(10)},"S-left":function(){b.inputing()||b.drawningboard.selector.moveleft(10)},"S-right":function(){b.inputing()||b.drawningboard.selector.moveright(10)},"C-c":function(){b.inputing()||b.drawningboard.selector.copy()},"C-v":function(){b.inputing()||b.drawningboard.selector.paste()},"C-d":function(){return b.inputing()?void 0:(b.drawningboard.selector.copy(),b.drawningboard.selector.paste(),!1)},"C-g":function(){return b.inputing()?void 0:(b.drawningboard.selector.group(),!1)},escape:function(){b.drawningboard.selector.unselect(),b.previewdialog&&b.previewdialog.return(),b.drawningboard.messagemenu&&b.drawningboard.messagemenu.hide()},"delete":function(a){b.inputing()||(a.preventDefault(),b.drawningboard.selector.delete())},backspace:function(a){b.inputing()||(a.preventDefault(),b.drawningboard.selector.delete())}})},b.animation=function(){},b.animation.undo=function(){b.dom.find(".undo svg").css("textIndent",720),b.dom.find(".undo svg").stop().animate({textIndent:0},{duration:500,step:function(a,c){"textIndent"==c.prop&&(b.dom.find(".undo svg").css("-webkit-transform","rotate("+a+"deg)"),b.dom.find(".undo svg").css("-ms-transform","rotate("+a+"deg)"),b.dom.find(".undo svg").css("-moz-transform","rotate("+a+"deg)"))},complete:function(){}})},b.animation.redo=function(){b.dom.find(".redo svg").css("textIndent",0),b.dom.find(".redo svg").stop().animate({textIndent:720},{duration:500,step:function(a,c){"textIndent"==c.prop&&(b.dom.find(".redo svg").css("-webkit-transform","rotate("+a+"deg)"),b.dom.find(".redo svg").css("-ms-transform","rotate("+a+"deg)"),b.dom.find(".redo svg").css("-moz-transform","rotate("+a+"deg)"))},complete:function(){}})},b.animation.preview=function(){b.dom.find(".preview svg").stop().slideUp("fast",function(){b.dom.find(".preview svg").slideDown("fast")})},b.start()};