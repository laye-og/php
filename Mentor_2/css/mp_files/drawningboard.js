Drawningboard=function(){var a=this;a.isSave=!1,a.model,a.dom,a.loading,a.position=[],a.workspace,a.selector,a.flowtab,a.informationtab,a.contexttab,a.toolbar,a.alignbar,a.currentstate=-1,a.messagemenu,a.ownerid,a.ownerkey,a.ownerpassword,a.ownerloginkey,a.ownermode=!1,a.fullaccess=!1,a.rights=0,a.editiconid=void 0,a.background,a.width,a.height,a.cliplist=[],a.recentcolors=[],a.fontlist=[],a.clipid=0,a.groupid=0,a.freemailquantity=0,a.textmeasurer,a.isOpera=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,a.isFirefox="undefined"!=typeof InstallTrigger,a.isSafari=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,a.isIOS=navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i),a.isChrome=!!window.chrome&&!a.isOpera,a.isIE=!1||!!document.documentMode,a.isTouch=$.touchSupport(),a.api=new Api,a.localStorageTest=function(){var a="test";try{return localStorage.setItem(a,a),localStorage.removeItem(a),!0}catch(b){return!1}},a.localStorageTest()===!0&&(a.ownerkey=window.localStorage.getItem("username"),a.ownercaptcha=window.localStorage.getItem("captcha"),a.ownerpassword=window.localStorage.getItem("password")),a.companyname=decodeURIComponent(getQueryVariable("companyname")),a.category=getQueryVariable("category"),a.icon=getQueryVariable("logo"),a.mode=getQueryVariable("mode"),a.firstdisplay=!0,a.plan=void 0,a.dominantcolor,a.showbackground=!1,a.fontsloaded=!1,a.start=function(){a.localStorageTest()===!0&&window.localStorage.clear(),a.api.loadLanguage(function(){$("body").on("dragover",function(a){a.stopPropagation(),a.preventDefault(),a.originalEvent.dataTransfer.dropEffect="copy"}),$("body").on("drop",function(a){a.stopPropagation(),a.preventDefault()}),a.dom=$("#workspace"),a.loading=$(".master-loading"),a.startloading(),colpick(a);var b=$('<svg id="textmeasurer"></svg>');$("#drawningboard").append(b),a.textmeasurer=Snap(b[0]),a.width=a.dom.width(),a.height=a.dom.height(),a.predraw()})},a.loadfonts=function(b,c){if("undefined"!=typeof b&&null!=b&&b.length>0)for(i=0;i<b.length;i++)b[i].name=b[i].name.replace(/['"]+/g,"");$.ajax({type:"post",url:a.api.font+"list",data:JSON.stringify({fontlist:b}),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(d){a.fontlist=d.obj,b||(a.fontsloaded=!0);var e=[];$.each(a.fontlist,function(a,b){b.googleimportstring&&e.push(b.googleimportstring)});for(var f=[],g=10;e.length>0;)f.push(e.splice(0,g));for(var h=0;h<f.length;h++)WebFont.load({google:{families:f[h]}});c&&c()})},a.predraw=function(){a.flowtab=new Flowtab(a),a.informationtab=new Informationtab(a),a.contexttab=new Contexttab(a),a.toolbar=new Toolbar(a),a.alignbar=new Alignbar(a),(a.isSafari||a.isTouch)&&a.fixSafari(),a.isIOS&&$("html").addClass("ipad ios7"),a.registerEvents(),a.draw()},a.fixSafari=function(){$("body").height(window.innerHeight),$("#logomaker").height(window.innerHeight),$("#logobody").height(window.innerHeight),window.scrollTo(0,0)},a.draw=function(){a.workspace=Snap("#workspace"),a.workspace.attr("text-rendering","geometricPrecision"),a.dom.on("contextmenu",function(){return!1}),a.showtooltips(),a.background=new Background(a),a.position=$("#drawningboard").position(),a.selector=new Selector(a),a.ownerkey&&"false"!=a.ownerkey?a.startownermode():a.toolbar.drawinitialelements()},a.startownermode=function(){$.ajax({type:"post",url:a.api.owner+"login",data:JSON.stringify({key:a.ownerkey,password:a.ownerpassword}),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(b){if(b.obj)if(1==b.obj.logged)a.ownermode=!0,a.fullaccess=1==b.obj.fullaccess,a.rights=b.obj.rights,a.ownerloginkey=b.obj.loginKey,a.ownerid=b.obj.id,a.toolbar.startownermode(),a.contexttab.startownermode(),a.loadfonts(void 0);else{var c=new Messagebox(a,"Invalid Owner Token!",null,"Ok",null,a.toolbar.drawinitialelements);c.show()}a.endloading()})},a.undraw=function(){a.workspace.clear(),a.selector.finish(),a.background.finish()},a.confirmmessage=function(){a.messagemenu&&a.messagemenu.confirm()},a.reset=function(){a.selector.unselect(),a.selector.endexplodedmode(),a.selector.closecontext(),a.undraw(),$.each(a.cliplist,function(a,b){b.finish()}),a.cliplist.splice(0),a.currentstate=-1,a.editiconid=void 0,a.toolbar.setdominantcolor("rgba(255, 255, 255, 0)"),a.draw(),a.selector.changed=0,a.clipid=0,a.groupid=0,a.dom.hide(),a.dom.slideUp("fast",function(){a.dom.slideDown("fast")})},a.select=function(b){a.selector.select(b)},a.formatsvg=function(a){a.find("img.svg").each(function(){var b=jQuery(this),c=b.attr("id"),d=b.attr("class"),e=b.attr("src");jQuery.get(e,function(e){var f=jQuery(e).find("svg");"undefined"!=typeof c&&(f=f.attr("id",c)),"undefined"!=typeof d&&(f=f.attr("class",d+" replaced-svg")),f=f.removeAttr("xmlns:a"),b.replaceWith(f),a.find("svg").show()},"xml")})},a.showtooltips=function(){/iPad/i.test(navigator.userAgent)||$(document).tooltip({show:{effect:"drop",direction:"up",duration:"fast"},position:{my:"left top+10",at:"left bottom"},close:function(a,b){b.tooltip.hide()}})},a.registerEvents=function(){$(window).on("resize",function(){a.width=a.dom.width(),a.height=a.dom.height(),a.selector.redrawbg()}),$(window).on("orientationchange",function(){(a.isSafari||a.isTouch)&&(a.fixSafari(),a.isIOS&&$("html").addClass("ipad ios7"))}),window.onbeforeunload=function(){return a.isSave?void 0:"Are you sure you want to quit without saving ?"}},a.addrecentcolor=function(b){var c=!1;$.each(a.recentcolors,function(a,d){b.r==d.r&&b.g==d.g&&b.b==d.b&&b.a==d.a&&(c=!0)}),c||(a.recentcolors.unshift(b),7==a.recentcolors.length&&a.recentcolors.pop())},a.startloading=function(){a.loading.fadeIn()},a.endloading=function(){a.loading.hide()}};