Contexttab=function(a){var b=this;b.dom,b.drawningboard=a,b.unselecteddom,b.carousel,b.holdinterval,b.radialing=!1,b.fontliststate,b.fontlistmouse=!0,b.selectboxstate,b.originalfont,b.textpanel,b.shapepanel,b.unselectpanel,b.currentpanel,b.emptytext,b.color,b.originalcolor,b.canBold=!1,b.canItalic=!1,b.clear=!1,b.start=function(){b.drawningboard.api.loadTemplate("contexttab",function(a){b.dom=$("#contexttab"),b.dom.append($(a)),b.carousel=b.dom.find(".carousel"),b.eventtype=b.drawningboard.isTouch?"touchstart":"mousedown",b.eventleavetype=b.drawningboard.isTouch?"touchend":"mouseup mouseout",b.textpanel=b.dom.find(".carousel .text"),b.shapepanel=b.dom.find(".carousel .shape"),b.unselectpanel=b.dom.find(".carousel .unselected"),b.carousel.owlCarousel({items:1,itemsTablet:[1920,1],itemsMobile:[1920,1],touchDrag:!1,mouseDrag:!1,pagination:!1}),b.dom.hide(),b.carousel.trigger("owl.goTo",1),b.dom.slideDown(200),b.dom.nodoubletapzoom(),b.drawningboard.formatsvg(b.dom),b.registerevents()})},b.finish=function(){b.carousel.data("owlCarousel").destroy(),b.dom.empty()},b.loadfonts=function(){var a=b.dom.find(".fontlist .wrapper");a.empty(),$.each(b.drawningboard.fontlist,function(b,c){a.append($('<div name="'+c.name+'" italic="'+c.italic+'" bold="'+c.bold+'" style="font-family: '+c.name+';">'+c.name+"</div>"))});var c=b.dom.find(".fontbox .fontlist");a.find("div").on("click",function(a){a.preventDefault?a.preventDefault():a.returnValue=!1,b.target.format.font=$(this).css("font-family").replace(/"/g,""),b.originalfont=b.target.format.font,b.target.update(),b.drawningboard.selector.changed=1,b.drawningboard.selector.save(),b.drawningboard.selector.gettargetdata(),b.drawningboard.selector.update(),b.updatepreview(),b.setselectedfont(b.target.format.font),c.hide(),b.fontliststate=!1}),b.drawningboard.isTouch||a.find("div").on("mouseover",function(){b.fontlistmouse&&b.selectfontlistitem($(this))});var d=b.dom.find(".fontbox .arrow-td"),e=b.dom.find(".fontbox .selected-font");e.add(d).unbind(b.eventtype).on(b.eventtype,function(){if(b.fontliststate)c.hide(),b.fontliststate=!1,b.target.format.font=b.originalfont,b.target.update(),b.drawningboard.selector.gettargetdata(),b.drawningboard.selector.update(),b.updatepreview();else if(b.drawningboard.fontsloaded){b.originalfont=b.target.format.font,c.show(),b.fontliststate=!0;var a=c.find(".wrapper div:contains('"+e.text()+"')");b.selectfontlistitem(a)}else b.drawningboard.loadfonts(void 0,function(){b.loadfonts(),b.originalfont=b.target.format.font,c.show(),b.fontliststate=!0;var a=c.find(".wrapper div:contains('"+e.text()+"')");b.selectfontlistitem(a)})})},b.unselect=function(){b.dom.find(".multiple").hide(),b.dom.find(".single").show(),b.dom.find(".multiple .direction-custom .spinner").val("0°"),b.dom.find(".preview").empty(),b.dom.find(".fontbox .fontlist").hide(),b.dom.find(".selectbox .selectorlist").hide(),b.fontliststate=!1,b.selectboxstate=!1,b.fontlistmouse=!0,b.target&&b.target.format&&b.fontliststate&&(b.target.format.font=b.originalfont),b.dom.find(".textbox input").is(":focus")&&b.dom.find(".textbox input").blur(),b.dom.find(".direction-custom .spinner").is(":focus")&&b.dom.find(".direction-custom .spinner").blur(),b.dom.find(".curved-text .command-action").removeClass("active"),b.dom.find(".selectbox .selector").empty()},b.select=function(a){setTimeout(function(){b.clear||b.unselect(),a instanceof Array?(b.clear=!1,1==a.length?a[0]instanceof Text?b.textselection(a[0]):a[0]instanceof Clip&&b.shapeselection(a[0]):b.multiselection(a),b.updatepreview()):(b.clear||b.unselection(),b.clear=!0)},1)},b.startownermode=function(){(b.drawningboard.fullaccess||2==b.drawningboard.rights)&&(b.unselectpanel.find(".reviewlogo").show(),b.unselectpanel.find(".addsvg").show())},b.unselection=function(){b.currentpanel=b.unselectpanel,b.dom.find(".unselected .commandbox").slideUp("fast"),b.dom.find(".unselected .colorbox.picker").hide(),b.dom.find(".unselected .colorbox.multipicker").show(),b.dom.find(".selectoriconlist").hide(),b.dom.find(".noselection-options").show(),b.startcolormultipicker(),b.carousel.trigger("owl.goTo",1)},b.multiselection=function(a){if(b.target=a,b.currentpanel=b.unselectpanel,b.target.length){var c=!0;$.each(b.target,function(a,d){b.target[0].color.compare(d.color)||(c=!1)}),b.startcolorselection(c?b.target[0].color:void 0),b.carousel.trigger("owl.goTo",1)}else b.startcolorselection(void 0);b.dom.find(".unselected .commandbox").stop().slideDown("fast"),b.dom.find(".unselected .colorbox.picker").show(),b.dom.find(".unselected .colorbox.multipicker").hide(),b.drawningboard.ownermode&&b.drawningboard.selector.targethavecompanytext()?(b.unselectpanel.find(".commandbox .commands .rotate .command-action").addClass("disabled"),b.unselectpanel.find(".commandbox .commands .flip .command-action").addClass("disabled"),b.unselectpanel.find(".commandbox .commands .delete .command-action").addClass("disabled")):(b.unselectpanel.find(".commandbox .commands .rotate .command-action").removeClass("disabled"),b.unselectpanel.find(".commandbox .commands .flip .command-action").removeClass("disabled"),b.unselectpanel.find(".commandbox .commands .delete .command-action").removeClass("disabled"))},b.shapeselection=function(a){b.target=a,b.currentpanel=b.shapepanel,b.startcolorselection(b.target.color),setTimeout(function(){b.carousel.trigger("owl.goTo",0)},15)},b.textselection=function(a){b.target=a,b.loadfonts(),b.currentpanel=b.textpanel,b.startcolorselection(b.target.color),b.starttextformatselection(b.target.format),setTimeout(function(){b.carousel.trigger("owl.goTo",2)},15),b.drawningboard.ownermode&&b.drawningboard.selector.targethavecompanytext()?(b.textpanel.find(".top-controls .textbox input").attr("readonly","readonly"),b.textpanel.find(".top-controls .textbox input").addClass("disabled"),b.textpanel.find(".commandbox .commands .rotate .command-action").addClass("disabled"),b.textpanel.find(".commandbox .commands .flip .command-action").addClass("disabled"),b.textpanel.find(".commandbox .commands .delete .command-action").addClass("disabled"),b.textpanel.find(".commandbox .commands .group .command-action").addClass("disabled"),b.textpanel.find(".reshape-item").hide()):(b.textpanel.find(".top-controls .textbox input").removeAttr("readonly"),b.textpanel.find(".top-controls .textbox input").removeClass("disabled"),b.textpanel.find(".commandbox .commands .rotate .command-action").removeClass("disabled"),b.textpanel.find(".commandbox .commands .flip .command-action").removeClass("disabled"),b.textpanel.find(".commandbox .commands .delete .command-action").removeClass("disabled"),b.textpanel.find(".commandbox .commands .group .command-action").removeClass("disabled"),b.textpanel.find(".reshape-item").show())},b.updatepreview=function(){if(b.target instanceof Array)if(b.drawningboard.selector.targetisicon()){var a=b.dom.find(".selectbox .selector");a.empty(),a.append($("<svg id='selectorframe'></svg><div class='selectorname'>"+b.target[0].iconname+"</div>"));var c=Snap("#selectorframe"),d=b.drawningboard.selector.getclipdata(b.target);$.each(b.target,function(a,b){var e=Snap(b.group.node.cloneNode(!0));e.attr({transform:"none",cursor:"pointer"}),e.attr({transform:"translate("+parseFloat(b.x-d.x1-b.translateoffset().x)+","+parseFloat(b.y-d.y1-b.translateoffset().y)+") rotate("+parseInt(calc.fixDegree(b.rotation))+" "+b.translateoffset().x+" "+b.translateoffset().y+") scale("+b.scalex*(parseFloat(b.flipx)?-1:1)+","+b.scaley*(parseFloat(b.flipy)?-1:1)+")"}),c.add(e)}),c.attr({viewBox:"0,0,"+d.width+","+d.height}),a.find("svg").css("width","50px"),a.find("svg").css("height","26px"),a.find("svg").css("margin-left","5px"),b.loadiconelements()}else b.loadiconelements();else{var e=b.currentpanel.find(".preview"),a=b.dom.find(".selectbox .selector");if(b.dom.find(".selectoriconlist").hide(),e.empty(),a.empty(),b.target instanceof Text)var f=Snap(b.target.svg.node.cloneNode(!0)),g=Snap(b.target.svg.node.cloneNode(!0));else var f=Snap(b.target.group.node.cloneNode(!0)),g=Snap(b.target.group.node.cloneNode(!0));if(f.attr({transform:"none",cursor:"pointer"}),g.attr({transform:"none",cursor:"pointer"}),b.target instanceof Text)f.attr({textpath:"","text-anchor":"start",dy:"1em"}),b.target.curvedline.enabled||g.attr({"text-anchor":"start"}),f.node.textContent=b.target.format.text;else{var h=[];h.push(b.target);var d=b.drawningboard.selector.getclipdata(h);f.attr({transform:"translate("+parseFloat(b.target.x-d.x1-b.target.translateoffset().x)+","+parseFloat(b.target.y-d.y1-b.target.translateoffset().y)+") rotate("+parseInt(calc.fixDegree(b.target.rotation))+" "+b.target.translateoffset().x+" "+b.target.translateoffset().y+") scale("+b.target.scalex*(parseFloat(b.target.flipx)?-1:1)+","+b.target.scaley*(parseFloat(b.target.flipy)?-1:1)+")"})}e.append($("<svg id='previewframe'></svg>")),a.append($("<svg id='selectorframe'></svg><div class='selectorname'>"+b.target.name+"</div>"));var i=Snap("#previewframe"),c=Snap("#selectorframe");b.target instanceof Text?(c.attr({viewBox:"0,0,"+b.target.curvedline.startwidth+","+b.target.curvedline.startheight}),i.attr({viewBox:"0,0,"+b.target.width+","+b.target.height})):(c.attr({viewBox:"0,0,"+d.width+","+d.height}),i.attr({viewBox:"0,0,"+b.target.width+","+b.target.height})),i.add(g),c.add(f),e.find("svg").css("width","100%"),e.find("svg").css("height","100%"),a.find("svg").css("width","50px"),a.find("svg").css("height","26p"),a.find("svg").css("margin-left","5px")}},b.starttextformatselection=function(a){void 0===a.font&&(a.font="Amarante"),a.font=a.font.replace(/\"/g,"");var c=b.currentpanel.find(".textbox input");c.val(a.text),c.attr("original",a.text);var d=b.currentpanel.find(".fontbox .bold");a.bold?d.addClass("active"):d.removeClass("active");var e=b.currentpanel.find(".fontbox .italic");a.italic?e.addClass("active"):e.removeClass("active"),b.setselectedfont(a.font),b.target.curvedline.enabled&&("up"==b.target.curvedline.type?b.dom.find(".reshape-action-up").addClass("active"):b.dom.find(".reshape-action-down").addClass("active")),b.dom.find(".align-text .command-action").removeClass("active"),b.target.format.alignment?"left"==b.target.format.alignment?b.dom.find(".align-action-left").addClass("active"):"center"==b.target.format.alignment?b.dom.find(".align-action-center").addClass("active"):"right"==b.target.format.alignment&&b.dom.find(".align-action-right").addClass("active"):b.dom.find(".align-action-center").addClass("active")},b.setselectedfont=function(a){b.originalfont=b.target.format.font;var c=b.currentpanel.find(".fontbox .selected-font"),d=a;d.indexOf(",")>=0&&(d=d.substring(0,d.lastIndexOf(","))),d=d.replace("'","").replace("'","");var e=b.currentpanel.find(".fontlist .wrapper div[name='"+d+"']");b.selectfontlistitem(e,!0),c.html($("<div style='font-size:15px;'>"+d+"</div>")),c.find("div").css("font-family",a)},b.focustextinput=function(){var a=b.currentpanel.find(".textbox input");a.focus(),a.select()},b.undo=function(){b.startcolormultipicker()},b.redo=function(){b.startcolormultipicker()},b.startcolormultipicker=function(){var a=!1;if($.each(b.drawningboard.cliplist,function(b,c){c.enabled()&&(a=!0)}),!a)return void b.dom.find(".colorbox.multipicker").hide();b.dom.find(".colorbox.multipicker .color-picker").remove(),$("body").find(".colpick").not("#colorpicker_bg").not("#colorpicker_dominant").remove();var c=[];$.each(b.drawningboard.cliplist,function(a,d){d.enabled()&&$.each(d.color.colorlist,function(a,d){var e=!1;$.each(c,function(a,b){d.color==b&&(e=!0)}),e||(c.push(d.color),cbx=new Maincolorbox(b,b.currentpanel.find(".colorbox.multipicker .contents"),new Color(d.color)),cbx.start())})})},b.startcolorselection=function(a){if(b.dom.find(".colorbox.picker .color-picker").remove(),$("body").find(".colpick").not("#colorpicker_bg").not("#colorpicker_dominant").remove(),a?b.color=a.clone():(b.color=new Gradient,b.color.colorlist.push(new Color(void 0))),b.originalcolor=b.color.clone(),1==b.color.colorlist.length)cbx=new Colorbox(b,b.currentpanel.find(".colorbox.picker .single"),b.color.colorlist[0]),cbx.start();else{b.currentpanel.find(".colorbox.picker .multiple").slideDown("fast"),b.currentpanel.find(".colorbox.picker .single").hide();var c=b.currentpanel.find(".colorbox.picker .multiple-track"),d=b.currentpanel.find(".colorbox.picker .direction-custom input");$.each(b.color.colorlist,function(a,d){setTimeout(function(){var a=new Colorbox(b,c,d,!0);a.start()},0)}),d.val(b.color.rotation+"°")}},b.updatespinvalue=function(a){b.drawningboard.selector.closecontext(),b.currentpanel.find(".direction-custom .spinner").dgspinner().val(a+"°"),b.dom.find(".multiple .radar").css("-webkit-transform","rotate("+a+"deg)"),b.color.rotation=a,b.updatecolor(),b.updatepreview(),b.drawningboard.selector.changed=1,b.drawningboard.selector.save(),b.drawningboard.selector.refreshindex()},b.loadiconelements=function(){var a=b.dom.find(".selectoriconlist .wrapper"),c=b.dom.find(".selectoriconlist");a.empty(),b.dom.find(".noselection-options").hide();var d=[];$.each(b.target,function(c,e){if(e.enabled())if(void 0==e.subid){var f=e.name.replace(" ","").replace(".","-");if(a.append($("<div class='listitem' clipname='"+e.name+"' clipiconname='"+e.iconname+"'><svg id='svglisticonitem"+f+"'></svg><span>"+e.name+"</span></div>")),e instanceof Text)var g=Snap(e.svg.node.cloneNode(!0));else var g=Snap(e.group.node.cloneNode(!0));if(g.attr({cursor:"pointer",transform:"none"}),e instanceof Text)g.attr({textpath:"","text-anchor":"start",dy:"1em"}),g.node.textContent=e.format.text;else{var h=[];h.push(e);var i=b.drawningboard.selector.getclipdata(h);g.attr({transform:"translate("+parseFloat(e.x-i.x1-e.translateoffset().x)+","+parseFloat(e.y-i.y1-e.translateoffset().y)+") rotate("+parseInt(calc.fixDegree(e.rotation))+" "+e.translateoffset().x+" "+e.translateoffset().y+") scale("+e.scalex*(parseFloat(e.flipx)?-1:1)+","+e.scaley*(parseFloat(e.flipy)?-1:1)+")"})}var j=Snap("#svglisticonitem"+f);j.attr(e instanceof Text?{viewBox:"0,0,"+e.curvedline.startwidth+","+e.curvedline.startheight}:{viewBox:"0,0,"+i.width+","+i.height}),$("#svglisticonitem"+f).css("width","50px"),$("#svglisticonitem"+f).css("height","26px"),$("#svglisticonitem"+f).css("margin-left","5px"),j.add(g)}else d.push(e)});var e;$.each(d,function(c,f){if(f.iconname!=e){e=f.iconname;var g=[],h=f.name.replace(" ","").replace(".","-");a.append($("<div class='listitem' clipname='"+f.iconname+"' clipiconname='"+f.iconname+"'><svg id='svglisticonitemicon"+h+"'></svg><span>"+f.iconname+"</span></div>"));var i=Snap("#svglisticonitemicon"+h);$.each(d,function(a,b){b.iconname==e&&g.push(b)});var j=b.drawningboard.selector.getclipdata(g);i.attr({viewBox:"0,0,"+j.width+","+j.height}),$("#svglisticonitemicon"+h).css("width","50px"),$("#svglisticonitemicon"+h).css("height","26px"),$("#svglisticonitemicon"+h).css("margin-left","5px"),$.each(g,function(a,b){var c=Snap(b.group.node.cloneNode(!0));c.attr({transform:"none",cursor:"pointer"}),c.attr({transform:"translate("+parseFloat(b.x-j.x1-b.translateoffset().x)+","+parseFloat(b.y-j.y1-b.translateoffset().y)+") rotate("+parseInt(calc.fixDegree(b.rotation))+" "+b.translateoffset().x+" "+b.translateoffset().y+") scale("+b.scalex*(parseFloat(b.flipx)?-1:1)+","+b.scaley*(parseFloat(b.flipy)?-1:1)+")"}),i.add(c)})}var h=f.name.replace(" ","").replace(".","-");a.append($("<div class='listitem' clipname='"+f.name+"' clipiconname='"+f.iconname+"''><svg id='svglisticonitem"+h+"'></svg><span>"+f.name+"</span></div>"));var k=Snap(f.group.node.cloneNode(!0));k.attr({transform:"none",cursor:"pointer"});var g=[];g.push(f);var j=b.drawningboard.selector.getclipdata(g);k.attr({transform:"translate("+parseFloat(f.x-j.x1-f.translateoffset().x)+","+parseFloat(f.y-j.y1-f.translateoffset().y)+") rotate("+parseInt(calc.fixDegree(f.rotation))+" "+f.translateoffset().x+" "+f.translateoffset().y+") scale("+f.scalex*(parseFloat(f.flipx)?-1:1)+","+f.scaley*(parseFloat(f.flipy)?-1:1)+")"});var i=Snap("#svglisticonitem"+h);i.attr({viewBox:"0,0,"+j.width+","+j.height}),$("#svglisticonitem"+h).css("width","50px"),$("#svglisticonitem"+h).css("height","26px"),$("#svglisticonitem"+h).css("margin-left","30px"),i.add(k)}),b.dom.find(".selectoriconlist .wrapper div").on("mouseover",function(){var a=$(this);if(a.attr("clipname")==a.attr("clipiconname")){var c=[];$.each(b.drawningboard.cliplist,function(b,d){d.iconname==a.attr("clipiconname")&&d.enabled()&&c.push(d)}),b.drawningboard.selector.highlight(c)}else $.each(b.drawningboard.cliplist,function(c,d){if(d.name==a.attr("clipname")&&d.enabled()){if("undefined"!=a.attr("clipiconname"))return void b.drawningboard.selector.highlight([d]);b.drawningboard.selector.highlight([d])}})}),b.dom.find(".selectoriconlist .wrapper div").on("mouseleave",function(){b.drawningboard.selector.unhighlight()}),b.dom.find(".selectoriconlist .wrapper").find("div").on("click",function(a){a.preventDefault?a.preventDefault():a.returnValue=!1,b.dom.find(".selectbox .selectorlist").hide(),b.selectboxstate=!1;var c=$(this);if(c.attr("clipname")==c.attr("clipiconname")){var d=[];b.drawningboard.selector.explodedmode&&b.drawningboard.selector.endexplodedmode(),$.each(b.drawningboard.cliplist,function(a,b){b.iconname==c.attr("clipiconname")&&b.enabled()&&d.push(b)}),b.drawningboard.selector.select(d,!0)}else $.each(b.drawningboard.cliplist,function(a,d){if(d.name==c.attr("clipname")&&d.enabled()){if("undefined"!=c.attr("clipiconname"))return void b.drawningboard.selector.startexplodedmode(d);b.drawningboard.selector.select([d],!0),b.drawningboard.selector.explodedmode&&b.drawningboard.selector.endexplodedmode()}})}),c.show()},b.loadselectlist=function(){var a=b.dom.find(".selectbox .selectorlist .wrapper");a.empty();var c=[];b.drawningboard.cliplist.sort(b.drawningboard.selector.compareclip),$.each(b.drawningboard.cliplist,function(d,e){if(e.enabled())if(void 0==e.subid){var f=e.name.replace(" ","").replace(".","-");if(a.append($("<div class='listitem' clipname='"+e.name+"' clipiconname='"+e.iconname+"''><svg id='svglistitem"+f+"'></svg><span>"+e.name+"</span></div>")),e instanceof Text)var g=Snap(e.svg.node.cloneNode(!0));else var g=Snap(e.group.node.cloneNode(!0));if(g.attr({transform:"none",cursor:"pointer"}),e instanceof Text)g.attr({textpath:"","text-anchor":"start",dy:"1em"}),g.node.textContent=e.format.text;else{var h=[];h.push(e);var i=b.drawningboard.selector.getclipdata(h);g.attr({transform:"translate("+parseFloat(e.x-i.x1-e.translateoffset().x)+","+parseFloat(e.y-i.y1-e.translateoffset().y)+") rotate("+parseInt(calc.fixDegree(e.rotation))+" "+e.translateoffset().x+" "+e.translateoffset().y+") scale("+e.scalex*(parseFloat(e.flipx)?-1:1)+","+e.scaley*(parseFloat(e.flipy)?-1:1)+")"})}var j=Snap("#svglistitem"+f);j.attr(e instanceof Text?{viewBox:"0,0,"+e.curvedline.startwidth+","+e.curvedline.startheight}:{viewBox:"0,0,"+i.width+","+i.height}),$("#svglistitem"+f).css("width","50px"),$("#svglistitem"+f).css("height","26px"),$("#svglistitem"+f).css("margin-left","5px"),j.add(g)}else c.push(e)});var d;c.sort(b.drawningboard.selector.compareclip),$.each(c,function(e,f){if(f.iconname!=d){d=f.iconname;var g=f.name.replace(" ","").replace(".","-");a.append($("<div class='listitem' clipname='"+f.iconname+"' clipiconname='"+f.iconname+"''><svg id='svglistitemicon"+g+"'></svg><span>"+f.iconname+"</span></div>"));var h=Snap("#svglistitemicon"+g),i=[];$.each(c,function(a,b){b.iconname==d&&i.push(b)});var j=b.drawningboard.selector.getclipdata(i);h.attr({viewBox:"0,0,"+j.width+","+j.height}),$.each(i,function(a,b){var c=Snap(b.group.node.cloneNode(!0));c.attr({transform:"none",cursor:"pointer"}),c.attr({transform:"translate("+parseFloat(b.x-j.x1-b.translateoffset().x)+","+parseFloat(b.y-j.y1-b.translateoffset().y)+") rotate("+parseInt(calc.fixDegree(b.rotation))+" "+b.translateoffset().x+" "+b.translateoffset().y+") scale("+b.scalex*(parseFloat(b.flipx)?-1:1)+","+b.scaley*(parseFloat(b.flipy)?-1:1)+")"}),h.add(c)}),$("#svglistitemicon"+g).css("width","50px"),$("#svglistitemicon"+g).css("height","26px"),$("#svglistitemicon"+g).css("margin-left","5px")}var g=f.name.replace(" ","").replace(".","-");a.append($("<div class='listitem' clipname='"+f.name+"' clipiconname='"+f.iconname+"''><svg id='svglistitem"+g+"'></svg><span>"+f.name+"</span></div>"));var k=Snap(f.group.node.cloneNode(!0));k.attr({transform:"none",cursor:"pointer"});var h=Snap("#svglistitem"+g),i=[];i.push(f);var j=b.drawningboard.selector.getclipdata(i);k.attr({transform:"translate("+parseFloat(f.x-j.x1-f.translateoffset().x)+","+parseFloat(f.y-j.y1-f.translateoffset().y)+") rotate("+parseInt(calc.fixDegree(f.rotation))+" "+f.translateoffset().x+" "+f.translateoffset().y+") scale("+f.scalex*(parseFloat(f.flipx)?-1:1)+","+f.scaley*(parseFloat(f.flipy)?-1:1)+")"}),h.attr({viewBox:"0,0,"+j.width+","+j.height}),$("#svglistitem"+g).css("width","50px"),$("#svglistitem"+g).css("height","26px"),$("#svglistitem"+g).css("margin-left","30px"),h.add(k)}),b.dom.find(".selectbox .selectorlist .wrapper").find("div").on("mouseenter",function(){var a=$(this);if(a.attr("clipname")==a.attr("clipiconname")){var c=[];$.each(b.drawningboard.cliplist,function(b,d){d.iconname==a.attr("clipiconname")&&d.enabled()&&c.push(d)}),b.drawningboard.selector.highlight(c)}else $.each(b.drawningboard.cliplist,function(c,d){if(d.name==a.attr("clipname")&&d.enabled()){if("undefined"!=a.attr("clipiconname"))return void b.drawningboard.selector.highlight([d]);b.drawningboard.selector.highlight([d])}})}),b.dom.find(".selectbox .selectorlist .wrapper").find("div").on("mouseleave",function(){b.drawningboard.selector.unhighlight()}),b.dom.find(".selectbox .selectorlist .wrapper").find("div").on("click",function(a){a.preventDefault?a.preventDefault():a.returnValue=!1,b.dom.find(".selectbox .selectorlist").hide(),b.selectboxstate=!1;var c=$(this);if(c.attr("clipname")==c.attr("clipiconname")){var d=[];b.drawningboard.selector.explodedmode&&b.drawningboard.selector.endexplodedmode(),$.each(b.drawningboard.cliplist,function(a,b){b.iconname==c.attr("clipiconname")&&b.enabled()&&d.push(b)}),b.drawningboard.selector.select(d,!0)}else $.each(b.drawningboard.cliplist,function(a,d){if(d.name==c.attr("clipname")&&d.enabled()){if("undefined"!=c.attr("clipiconname"))return void b.drawningboard.selector.startexplodedmode(d);b.drawningboard.selector.select([d],!0),b.drawningboard.selector.explodedmode&&b.drawningboard.selector.endexplodedmode()}})})},b.fontup=function(){b.drawningboard.selector.closecontext(),b.fontlistmouse=!1;var a=b.dom.find(".fontbox .fontlist"),c=a.find(".wrapper div.selected"),d=c[0].previousElementSibling;d&&b.selectfontlistitem(d)},b.fontdown=function(){b.drawningboard.selector.closecontext(),b.fontlistmouse=!1;var a=b.dom.find(".fontbox .fontlist"),c=a.find(".wrapper div.selected"),d=c[0].nextElementSibling;d&&b.selectfontlistitem(d)},b.selectfontlistitem=function(a,c){b.drawningboard.selector.closecontext();var d=b.dom.find(".fontbox .fontlist");d.find(".wrapper div").removeClass("selected");var e=$(a);e.addClass("selected"),e.attr("tabindex","-1"),e.focus(),e.removeAttr("tabindex"),c||(b.currentpanel.find(".fontbox .bold").removeClass("active"),b.currentpanel.find(".fontbox .italic").removeClass("active"),b.target.format.bold=!1,b.target.format.italic=!1),"0"==e.attr("italic")?(b.currentpanel.find(".fontbox .italic").addClass("disabled"),b.canItalic=!1):(b.currentpanel.find(".fontbox .italic").removeClass("disabled"),b.canItalic=!0),"0"==e.attr("bold")?(b.currentpanel.find(".fontbox .bold").addClass("disabled"),b.canBold=!1):(b.currentpanel.find(".fontbox .bold").removeClass("disabled"),b.canBold=!0),b.target.format.font=e.css("font-family"),b.target.update(),b.drawningboard.selector.gettargetdata(),b.drawningboard.selector.update(),b.updatepreview()},b.fontenter=function(){b.drawningboard.selector.closecontext();var a=b.dom.find(".fontbox .fontlist"),c=a.find(".wrapper div.selected");c.trigger("click")},b.updatealignment=function(a){b.drawningboard.selector.closecontext(),b.target.format.alignment!=a&&(b.target.format.alignment=a,b.target.update())},b.registerevents=function(){b.textpanel.on("touchmove",function(a){$(a.target).parents(".owl-item")[0]||a.preventDefault()}),b.unselectpanel.find(".addtext").on(b.eventtype,function(){b.drawningboard.toolbar.addtext()}),b.unselectpanel.find(".addshape").on(b.eventtype,function(){b.drawningboard.toolbar.addshape()}),b.unselectpanel.find(".addlogo").on(b.eventtype,function(){b.drawningboard.toolbar.addlogo()}),b.unselectpanel.find(".addicon").on(b.eventtype,function(){b.drawningboard.toolbar.addicon()}),b.unselectpanel.find(".addsvg").on(b.eventtype,function(){b.drawningboard.toolbar.addsvg()}),b.unselectpanel.find(".reviewlogo").on(b.eventtype,function(){b.drawningboard.toolbar.reviewicon()}),b.dom.find(".multiple .color-add").on(b.eventtype,function(a){if(b.color.colorlist.length<10){var c=new Color(b.color.colorlist[0].color);c.position=50,b.color.colorlist.push(c);var d=new Colorbox(b,b.currentpanel.find(".multiple-track"),c,!0);d.autoopen=!0,d.event=a,d.start(),b.drawningboard.selector.refreshindex()}else{var e=new Messagebox(b.drawningboard,b.drawningboard.api.dictionary.contexttab_color_limit,null,null,b.drawningboard.api.dictionary.ok);e.show()}}),b.dom.find(".single .color-add").on(b.eventtype,function(){b.currentpanel.find(".multiple").slideDown(300),b.currentpanel.find(".single").hide(),b.currentpanel.find(".single .color-picker").remove(),b.color.colorlist[0].position=0,b.color.colorlist[0].color||(b.color.colorlist[0].color="rgba(0, 0, 0, 1)");var a=new Colorbox(b,b.currentpanel.find(".multiple-track"),b.color.colorlist[0],!0);a.start();var c=new Color(b.color.colorlist[0].color);c.position=100,b.color.colorlist.push(c);var d=new Colorbox(b,b.currentpanel.find(".multiple-track"),c,!0);d.autoopen=!0,d.start(),b.drawningboard.selector.refreshindex()}),$.widget("ui.dgspinner",$.ui.spinner,{options:{step:1,spin:function(a,c){return"radial"==b.color.type?($(this).dgspinner("value",0),!1):c.value>=360?($(this).dgspinner("value",0),!1):c.value<0?($(this).dgspinner("value",359),!1):(b.color.rotation=c.value,b.updatecolor(),void b.updatepreview())},change:function(){parseInt($(this).val())<0?$(this).val("0°"):parseInt($(this).val())>=360?$(this).val("0°"):isNaN(parseInt($(this).val()))&&$(this).val("0°")}},_parse:function(a){return parseFloat(a)},_format:function(a){return a+"°"}});var a=b.dom.find(".multiple .direction-custom .spinner");a.dgspinner().val("0°"),a.on("blur",function(){b.drawningboard.selector.closecontext();var a=b.currentpanel.find(".multiple .direction-custom .spinner");0!=parseInt(a.val())&&b.updatespinvalue(parseInt(a.val()))}),a.keyup(function(a){if(13==a.keyCode){var c=b.currentpanel.find(".multiple .direction-custom .spinner");b.updatespinvalue(parseInt(c.val()))}}),a.mouseup(function(a){return a.preventDefault(),!1}),a.on("focus",function(){b.drawningboard.selector.closecontext(),b.drawningboard.isIOS||b.drawningboard.isSafari?this.setSelectionRange(0,9999):a.select()});var c=b.dom.find(".textbox input");c.on("keyup",function(a){b.drawningboard.selector.closecontext();var c=b.currentpanel.find(".textbox input"),d=c.val();if(""==d){d="ˆ",b.emptytext||(b.originalcolor=b.target.color.clone()),b.emptytext=!0,b.drawningboard.selector.displaycontrols=!1,b.drawningboard.selector.updateselector();var e=new Gradient;e.colorlist.push(new Color("rgba(255,255,255,0)")),b.target.color=e}else b.emptytext&&(b.target.color=b.originalcolor,b.drawningboard.selector.displaycontrols=!0),b.emptytext=!1;b.target.format.text=d,b.target.update(),c.val()==c.attr("original")||b.emptytext||(b.drawningboard.selector.changed=1,b.drawningboard.selector.save(),c.attr("original",c.val())),b.drawningboard.selector.gettargetdata(),b.drawningboard.selector.update(),b.updatepreview(),13==a.keyCode&&c.blur()}),c.on("paste",function(){b.drawningboard.selector.closecontext(),setTimeout(function(){var a=b.currentpanel.find(".textbox input"),c=a.val();b.emptytext&&(b.target.color=b.originalcolor,b.emptytext=!1,b.drawningboard.selector.displaycontrols=!0),b.target.format.text=c,b.target.update(),a.val()!=a.attr("original")&&(b.drawningboard.selector.changed=1,b.drawningboard.selector.save(),a.attr("original",a.val())),b.drawningboard.selector.gettargetdata(),b.drawningboard.selector.update(),b.updatepreview()},100)}),c.on("blur",function(){b.drawningboard.selector.closecontext(),b.emptytext&&(b.target.format.text="New Text",b.target.color=b.originalcolor,b.target.update(),b.drawningboard.selector.displaycontrols=!0,b.drawningboard.selector.changed=1,b.drawningboard.selector.save(),b.drawningboard.selector.gettargetdata(),b.drawningboard.selector.update(),b.updatepreview());var a=b.currentpanel.find(".textbox input");a.val(b.target.format.text)});var d=b.dom.find(".fontbox .bold"),e=b.dom.find(".fontbox .italic");d.on(b.eventtype,function(){if(b.drawningboard.selector.closecontext(),b.canBold){var a=b.currentpanel.find(".fontbox .bold");b.target.format.bold?(b.target.format.bold=!1,a.removeClass("active")):(b.target.format.bold=!0,a.addClass("active")),b.target.update(),b.drawningboard.selector.changed=1,b.drawningboard.selector.save(),b.drawningboard.selector.gettargetdata(),b.drawningboard.selector.update(),b.updatepreview()}}),e.on(b.eventtype,function(){if(b.drawningboard.selector.closecontext(),b.canItalic){var a=b.currentpanel.find(".fontbox .italic");b.target.format.italic?(b.target.format.italic=!1,a.removeClass("active")):(b.target.format.italic=!0,a.addClass("active")),b.target.update(),b.drawningboard.selector.changed=1,b.drawningboard.selector.save(),b.drawningboard.selector.gettargetdata(),b.drawningboard.selector.update(),b.updatepreview()}});var f=b.dom.find(".selectbox table"),g=b.dom.find(".selectbox .selectorlist");f.on(b.eventtype,function(){b.drawningboard.selector.closecontext(),b.selectboxstate?(g.hide(),b.selectboxstate=!1):(b.loadselectlist(),g.show(),b.selectboxstate=!0,b.dom.find(".fontbox .fontlist").hide(),b.fontliststate=!1)}),b.dom.find(".multiple .direction-1").on(b.eventtype,function(){a.attr("readonly",!1),b.color.rotation=0==b.color.rotation?180:0,b.color.type="linear",b.updatespinvalue(b.color.rotation)}),b.dom.find(".multiple .direction-2").on(b.eventtype,function(){a.attr("readonly",!1),b.color.rotation=90==b.color.rotation?270:90,b.color.type="linear",b.updatespinvalue(b.color.rotation)}),b.dom.find(".multiple .direction-3").on(b.eventtype,function(){a.attr("readonly",!1),b.color.rotation=225==b.color.rotation?45:225,b.color.type="linear",b.updatespinvalue(b.color.rotation)}),b.dom.find(".multiple .direction-4").on(b.eventtype,function(){a.attr("readonly",!1),b.color.rotation=135==b.color.rotation?315:135,b.color.type="linear",b.updatespinvalue(b.color.rotation)}),b.dom.find(".multiple .direction-radial").on(b.eventtype,function(){a.attr("readonly",!0),b.color.rotation=0,b.color.type="radial",b.color.origin="in"==b.color.origin?"out":"in",b.updatespinvalue(b.color.rotation)}),b.drawningboard.isTouch&&b.dom.find(".command-item").addClass("no-hover"),b.dom.find(".move-up").on(b.eventtype,function(){b.drawningboard.selector.moveup(1),b.drawningboard.selector.contextaction=!0,b.preholdinterval=setInterval(function(){b.holdinterval=setInterval(function(){clearInterval(b.preholdinterval),b.drawningboard.selector.moveup(1)},50)},200)}),b.dom.find(".move-down").on(b.eventtype,function(){b.drawningboard.selector.movedown(1),b.drawningboard.selector.contextaction=!0,b.preholdinterval=setInterval(function(){b.holdinterval=setInterval(function(){clearInterval(b.preholdinterval),b.drawningboard.selector.movedown(1)},50)},200)}),b.dom.find(".move-right").on(b.eventtype,function(){b.drawningboard.selector.moveright(1),b.drawningboard.selector.contextaction=!0,b.preholdinterval=setInterval(function(){b.holdinterval=setInterval(function(){clearInterval(b.preholdinterval),b.drawningboard.selector.moveright(1)
},50)},200)}),b.dom.find(".move-left").on(b.eventtype,function(){b.drawningboard.selector.moveleft(1),b.drawningboard.selector.contextaction=!0,b.preholdinterval=setInterval(function(){b.holdinterval=setInterval(function(){clearInterval(b.preholdinterval),b.drawningboard.selector.moveleft(1)},50)},200)}),b.dom.find(".flip-horizontal").on(b.eventtype,function(){b.drawningboard.ownermode&&b.drawningboard.selector.targethavecompanytext()||(b.drawningboard.selector.fliphorizontal(),b.drawningboard.selector.contextaction=!0)}),b.dom.find(".flip-vertical").on(b.eventtype,function(){b.drawningboard.ownermode&&b.drawningboard.selector.targethavecompanytext()||(b.drawningboard.selector.flipvertical(),b.drawningboard.selector.contextaction=!0)}),b.dom.find(".layer-up").on(b.eventtype,function(){b.drawningboard.selector.front(),b.drawningboard.selector.contextaction=!0}),b.dom.find(".layer-down").on(b.eventtype,function(){b.drawningboard.selector.back(),b.drawningboard.selector.contextaction=!0}),b.dom.find(".layer-up-all").on(b.eventtype,function(){b.drawningboard.selector.frontall(),b.drawningboard.selector.contextaction=!0}),b.dom.find(".layer-down-all").on(b.eventtype,function(){b.drawningboard.selector.backall(),b.drawningboard.selector.contextaction=!0}),b.dom.find(".command-item.copy").on(b.eventtype,function(){b.drawningboard.selector.copy(),b.drawningboard.selector.paste(),b.drawningboard.selector.contextaction=!0}),b.dom.find(".command-item.group").on(b.eventtype,function(){b.drawningboard.ownermode&&b.drawningboard.selector.targethavecompanytext()||(b.drawningboard.selector.group(),b.drawningboard.selector.contextaction=!0)}),b.dom.find(".scale-up").on(b.eventtype,function(){b.drawningboard.selector.upscale(),b.drawningboard.selector.contextaction=!0,b.preholdinterval=setInterval(function(){b.holdinterval=setInterval(function(){clearInterval(b.preholdinterval),b.drawningboard.selector.upscale()},50)},200)}),b.dom.find(".scale-down").on(b.eventtype,function(){b.drawningboard.selector.downscale(),b.drawningboard.selector.contextaction=!0,b.preholdinterval=setInterval(function(){b.holdinterval=setInterval(function(){clearInterval(b.preholdinterval),b.drawningboard.selector.downscale()},50)},200)}),b.dom.find(".rotate-left").on(b.eventtype,function(){b.drawningboard.ownermode&&b.drawningboard.selector.targethavecompanytext()||(b.drawningboard.selector.rotateleft(),b.drawningboard.selector.contextaction=!0,b.preholdinterval=setInterval(function(){b.holdinterval=setInterval(function(){clearInterval(b.preholdinterval),b.drawningboard.selector.rotateleft()},50)},200))}),b.dom.find(".rotate-right").on(b.eventtype,function(){b.drawningboard.ownermode&&b.drawningboard.selector.targethavecompanytext()||(b.drawningboard.selector.rotateright(),b.drawningboard.selector.contextaction=!0,b.preholdinterval=setInterval(function(){b.holdinterval=setInterval(function(){clearInterval(b.preholdinterval),b.drawningboard.selector.rotateright()},50)},200))}),b.dom.find(".align-action-left").on(b.eventtype,function(){b.dom.find(".align-text .command-action").removeClass("active"),b.dom.find(".align-action-left").addClass("active"),b.updatealignment("left")}),b.dom.find(".align-action-center").on(b.eventtype,function(){b.dom.find(".align-text .command-action").removeClass("active"),b.dom.find(".align-action-center").addClass("active"),b.updatealignment("center")}),b.dom.find(".align-action-right").on(b.eventtype,function(){b.dom.find(".align-text .command-action").removeClass("active"),b.dom.find(".align-action-right").addClass("active"),b.updatealignment("right")}),b.dom.find(".reshape-action-up").on(b.eventtype,function(){b.target.curvedline.enabled&&"up"==b.target.curvedline.type?(b.dom.find(".reshape-action-up").removeClass("active"),b.target.curvedline.enabled=!1):(b.dom.find(".curved-text .command-action").removeClass("active"),b.dom.find(".reshape-action-up").addClass("active"),b.target.curvedline.enabled=!0,b.target.curvedline.type="up"),b.drawningboard.selector.reshape()}),b.dom.find(".reshape-action-down").on(b.eventtype,function(){b.target.curvedline.enabled&&"down"==b.target.curvedline.type?(b.dom.find(".reshape-action-down").removeClass("active"),b.target.curvedline.enabled=!1):(b.dom.find(".curved-text .command-action").removeClass("active"),b.dom.find(".reshape-action-down").addClass("active"),b.target.curvedline.enabled=!0,b.target.curvedline.type="down"),b.drawningboard.selector.reshape()}),b.dom.find(".delete").on(b.eventtype,function(){b.drawningboard.ownermode&&b.drawningboard.selector.targethavecompanytext()||(b.drawningboard.selector.delete(),b.drawningboard.selector.contextaction=!0)}),b.dom.find(".command-item").on(b.eventleavetype,function(){clearInterval(b.holdinterval),clearInterval(b.preholdinterval),b.drawningboard.selector.contextrelease()}),b.dom.find(".copy-colors").on(b.eventtype,function(){b.drawningboard.selector.copycolors()}),b.dom.find(".paste-colors").on(b.eventtype,function(){b.drawningboard.selector.pastecolors()})},b.updatecolor=function(){b.target instanceof Array?$.each(b.target,function(a,c){c.color=b.color.clone(),c.update()}):(b.target.color=b.color.clone(),b.target.update())},b.start()};