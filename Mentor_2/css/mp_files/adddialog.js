AddDialog=function(a,b){var c=this;c.drawningboard=a,c.dom,c.selected,c.list,c.type=b,c.adding=!1,c.editmode=!1,c.status,c.owner,c.loading=!1,c.currentpage=1,c.randomseed=1e3*Math.random(),c.confirm=function(){},c.show=function(){c.drawningboard.api.loadTemplate("adddialog",function(a){if(c.dom=$(a),$("#logobody").append(c.dom),c.dom.hide(),c.dom.fadeIn(200),c.drawningboard.plan&&"0"!=c.drawningboard.plan&&("logo"==c.type||"icon"==c.type)){var b=new Messagebox(c.drawningboard,c.drawningboard.api.dictionary.adddialog_purchase_modification_message,void 0,c.drawningboard.api.dictionary.ok);b.show()}c.drawningboard.messagemenu=c,c.status=c.dom.find(".admin-mode .status select"),c.owner=c.dom.find(".admin-mode .admin select"),c.drawningboard.ownermode&&(c.dom.find(".admin-mode").show(),c.drawningboard.fullaccess||(c.dom.find(".admin-mode .admin").hide(),c.dom.find(".status select option[value='4']").remove()),c.loadowners()),c.registerevents(),c.drawningboard.icon&&c.drawningboard.firstdisplay?(c.retrievelogo(c.drawningboard.icon),c.dom.hide()):c.drawningboard.fontsloaded?c.startpopup():c.drawningboard.loadfonts(void 0,c.startpopup)})},c.startpopup=function(){c.drawningboard.endloading(),"logo"==c.type?c.showlogodialog():"icon"==c.type?c.showicondialog():c.showshapedialog()},c.back=function(){if(c.dom.fadeIn(200),c.dom.find(".search-wrapper input").focus(),c.dom.find(".search-wrapper input").select(),c.drawningboard.messagemenu=c,c.drawningboard.plan&&"0"!=c.drawningboard.plan&&("logo"==c.type||"icon"==c.type)){var a=new Messagebox(c.drawningboard,c.drawningboard.api.dictionary.adddialog_purchase_modification_message,void 0,c.drawningboard.api.dictionary.ok);a.show()}},c.loadiconfonts=function(a,b){var d=[];a.text_list.length>0&&$.each(a.text_list,function(a,b){var c=JSON.parse(b.format);d.push({name:c.font})}),c.drawningboard.loadfonts(d,b)},c.retrievelogo=function(a){$.ajax({type:"post",url:c.drawningboard.api.logo+"get",data:JSON.stringify({guid:a}),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(b){1==b.status?(c.list=[b.obj],c.loadiconfonts(b.obj,function(){c.proccessaddlogo(a),c.drawningboard.endloading()})):(c.drawningboard.firstdisplay=!1,c.hide())})},c.hide=function(){c.dom.fadeOut(200,function(){"icon"!=c.type?c.dom.remove():(c.adding=!1,c.dom.find(".load").hide()),c.drawningboard.messagemenu=void 0})},c.loadowners=function(){c.currentpage=1;var a=$(".add-dialog .topbar .admin select");$.ajax({type:"post",url:c.drawningboard.api.owner+"list",dataType:"json"}).done(function(b){owner_list=b.obj,$.each(owner_list,function(b,c){var d=$("<option>"+c.key+"</option>"),e=$("<option>"+c.key+"</option>");d.attr("value",c.id),e.attr("value",c.id),a.append(e)})})},c.registerevents=function(){c.dom.find("div.close").on("click",function(){c.hide()}),c.dom.find("td.cancel-td").on("click",function(){c.hide()}),c.dom.find("td.confirm-td").on("click",function(){c.add()}),c.dom.find("td.search-td").on("click",function(){c.dom.find(".search-icon").trigger("mouseup")}),c.dom.find("td.edit-td").on("click",function(){c.editicon()})},c.loadcategories=function(){c.currentpage=1,c.retrievelogos(1,c.drawningboard.category);var a=c.dom.find(".category-others ul.root");if(a.empty(),c.dom.find(".leftbar .load").show(),c.drawningboard.ownermode)var b=c.status.val();else var b=1;$.ajax({type:"post",url:c.drawningboard.api.category+"list",data:JSON.stringify({status:b,owner:c.owner.val(),loginKey:c.drawningboard.ownerkey}),dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(b){if("1"==b.status){var d=$('<li catid="0"><span class="name" lang="category_all"></span></li>');if(d=c.drawningboard.api.fillTemplateLanguage(d),a.append(d),a.find("li[catid='0']").addClass("selected"),b.obj&&b.obj.length>0){$.each(b.obj,function(a,b){b.description=c.drawningboard.api.dictionary["category_"+b.id],void 0==b.description&&(b.description="undefined")});var e=b.obj;e.sort(function(a,b){return a.description.toUpperCase()>b.description.toUpperCase()?1:a.description<b.description?-1:void 0});var f=0;$.each(e,function(b,c){if(0!=c.qtd){var d=$('<li><i class="fa fa-minus"></i><span class="name"></span><span>(</span><span class="qtd"></span><span>)</span></li>');if(d.find(".name").html(c.description),d.find(".qtd").html(c.qtd),d.attr("catid",c.id),f+=c.qtd,a.append(d),c.subcategory){var e=$("<ul></ul>");e.attr("catid",c.id),e.hide();var g=0;$.each(c.subcategory,function(a,b){if(0!=b.qtd){g++,d.find(".fa").removeClass("fa-minus").addClass("fa-plus");var c=$('<li><span class="name"></span><span>(</span><span class="qtd"></span><span>)</span></li>');c.find(".name").html(b.description),c.find(".qtd").html(b.qtd),c.attr("catid",b.id),e.append(c)}}),g>0?(e.hide(),a.append(e),d.find(".fa").on("click",function(){$(e).is(":visible")?(e.slideUp("fast"),d.find(".fa").removeClass("fa-minus").addClass("fa-plus")):(e.slideDown("fast"),d.find(".fa").removeClass("fa-plus").addClass("fa-minus"))})):(d.find(".fa").remove(),d.find(".name").css("padding-left","18px"))}else d.find(".fa").remove(),d.find(".name").css("padding-left","18px")}})}a.find("li").on("click",function(){a.find("li").removeClass("selected"),$(this).addClass("selected"),c.currentpage=1,c.retrievelogos(1,$(this).attr("catid"))}),c.dom.find(".leftbar .load").fadeOut("fast"),c.drawningboard.category&&(a.find("li").removeClass("selected"),a.find("li[catid='"+c.drawningboard.category+"']").addClass("selected"))}else"0"==obj.status&&c.dom.find(".body .load").fadeOut("fast")})},c.showicondialog=function(){c.dom.find(".admin-mode").hide(),c.dom.find(".title-name").html(c.drawningboard.api.dictionary.adddialog_icon_title),c.dom.find(".title .icon").attr("src","img/Add_Icon.svg"),c.dom.find(".list").css("height","100%"),c.dom.find(".search-wrapper").show(),c.dom.find(".pagination").hide(),c.dom.find(".confirm-td").hide(),c.dom.find(".search-td").show(),c.dom.find(".search-icon").on("mouseup",function(){""!=c.dom.find(".search-wrapper input").val().trim()&&c.starticonsearch()}),c.dom.find(".search-wrapper input").focus(),c.dom.find(".search-wrapper input").on("keyup",function(a){13==a.keyCode&&c.dom.find(".search-icon").trigger("mouseup")}),c.dom.find(".list-wrapper").on("scroll",function(){$(this)[0].offsetHeight+$(this).scrollTop()>=$(this)[0].scrollHeight&&(c.loading||(c.dom.find(".body .load").fadeIn("fast"),c.iconsearch()))})},c.iconsearch=function(){var a=c.dom.find(".search-wrapper input").val();c.loading=!0,$.ajax({type:"post",url:c.drawningboard.api.noun+"search",data:JSON.stringify({term:a,limit:200,page:c.currentpage}),dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(a){"1"==a.status?(c.currentpage++,c.list=c.list?c.list.concat(a.obj):a.obj,c.list&&($.each(a.obj,function(a,b){var d=$('<div class="item"></div>'),e=$('<img height="84px" width="84px">');e.attr("src",b.pngurl),d.attr("iconid",b.id),d.append(e),c.dom.find(".list-wrapper").append(d),c.dom.find(".body .load").fadeOut("fast"),c.loading=!1}),c.list.length<=18&&c.showiconendmessage(),c.dom.find(".list-wrapper .item").unbind("click").on("click",function(){$(this).hasClass("selected")?c.add():(c.selected=$(this),c.dom.find(".list-wrapper .item").removeClass("selected"),$(this).addClass("selected"))}))):c.showiconendmessage()})},c.addicon=function(){if(!c.adding){c.dom.find(".body .load").fadeIn("fast"),c.adding=!0;var a=c.selected.attr("iconid"),b=$.grep(c.list,function(b){return b.id==a})[0];$.ajax({type:"post",url:c.drawningboard.api.noun+"svg",data:JSON.stringify({url:b.svgurl}),dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(b){c.drawningboard.clipid++,c.drawningboard.selector.target=[],c.drawningboard.plan=b.obj.paid_item_number,c.drawningboard.toolbar.proccesssvg(b.obj.svg,a),c.hide()})}},c.showiconendmessage=function(){if(c.dom.find(".list-wrapper .message").remove(),1==c.currentpage)var a=$('<div class="message"><span>No results to show.</span></div>');else var a=$('<div class="message"><span>No more results to show.</span></div>');c.dom.find(".list-wrapper").append(a),c.dom.find(".body .load").fadeOut("fast")},c.starticonsearch=function(){c.list=void 0,c.currentpage=1,c.dom.find(".body .load").fadeIn("fast"),c.dom.find(".body .search-wrapper").addClass("searching"),c.dom.find(".body .list-wrapper").addClass("searching"),c.dom.find(".confirm-td").show(),c.dom.find(".search-td").hide(),c.dom.find(".list-wrapper").empty(),c.iconsearch()},c.showlogodialog=function(){c.dom.find(".wrapper").css({width:"90%",height:"90%"}).addClass("logowindow"),c.dom.find(".list").css("height","auto"),c.dom.find(".leftbar").show().css("height","86%"),c.dom.find(".title-name").html(c.drawningboard.api.dictionary.adddialog_logo_title),c.dom.find(".title .icon").attr("src","img/Add_Logo.svg"),c.dom.find(".body .load").hide(),c.dom.find(".body").css({height:"86%",width:"calc(100% - 280px)","overflow-y":"scroll"}),c.loadcategories(),c.status.on("change",function(){c.loadcategories()}),c.owner.on("change",function(){c.loadcategories()})},c.retrievelogos=function(a,b){if(!c.dom.find(".body .load").is(":visible")){if(c.dom.find(".body .load").fadeIn("fast"),c.dom.find(".list-wrapper").empty(),c.drawningboard.ownermode)var d=c.status.val();else var d=1;$.ajax({type:"post",url:c.drawningboard.api.logo+"list",data:JSON.stringify({page:a,category:b,pagesize:15,owner:c.owner.val(),status:d,loginKey:c.drawningboard.ownerkey,randomseed:c.randomseed}),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(a){if("1"==a.status){if(c.list=a.obj,c.list&&$.each(c.list,function(a,b){var d=getthumb(b,c.drawningboard.companyname),e=$('<div class="item"></div>');e.attr("svgid",b.id),e.append(d.svg),c.dom.find(".list-wrapper").append(e),c.dom.find(".body .load").fadeOut("fast")}),a.vars.pages>1){c.dom.find(".totalpage").hide(),c.dom.find(".paginationOf").hide(),c.dom.find(".curpage").hide();var b=c.dom.find(".centerpagination");b.html(""),$(".firstpage").remove(),$(".lastpage").remove();var d;d=a.vars.curpage<3?1:a.vars.curpage-2;var e;e=a.vars.curpage+2<=a.vars.pages&&a.vars.curpage>2?a.vars.curpage+2:a.vars.curpage<=2&&a.vars.pages>=5?5:a.vars.pages,c.dom.find(".pagination-wrapper").prepend('<span data-page="1" class="firstpage">&#171;</span>');for(var f=d;e>=f;f++)b.append('<span data-page="'+f+'" class="logopage '+(f==a.vars.curpage?"active":"")+'">'+f+"</span>");a.vars.pages>6&&a.vars.curpage+2<a.vars.pages&&b.append('<span class="Points deactivated">...</span>'),a.vars.pages>5&&a.vars.curpage+2<a.vars.pages&&b.append('<span data-page="'+a.vars.pages+'" class="logopage '+(a.vars.pages==a.vars.curpage?"active":"")+'">'+a.vars.pages+"</span>"),a.vars.curpage<a.vars.pages&&c.dom.find(".pagination-wrapper").append('<span class="lastpage" > &#187; </span>'),c.dom.find(".pagination-wrapper").css("visibility","visible"),c.dom.find(".pagination-wrapper .next").unbind("mouseup"),c.dom.find(".pagination-wrapper .previous").unbind("mouseup"),a.vars.pages>a.vars.curpage?(c.dom.find(".pagination-wrapper .next").removeClass("disabled"),c.dom.find(".pagination-wrapper .next").on("mouseup",function(){c.nextpage()}),$(".lastpage").on("click",function(){c.page(a.vars.pages)}).removeClass("disable")):(c.dom.find(".pagination-wrapper .next").addClass("disabled"),$(".lastpage").addClass("disabled")),a.vars.curpage>1?(c.dom.find(".curpage").html(a.vars.curpage),c.dom.find(".pagination-wrapper .previous").removeClass("disabled"),c.dom.find(".pagination-wrapper .previous").on("mouseup",function(){c.prevpage()}),$(".firstpage").on("click",function(){c.page(1)}).removeClass("disable")):(c.dom.find(".pagination-wrapper .previous").addClass("disabled"),$(".firstpage").addClass("disabled")),$(".logopage").on("click",function(){c.page($(this).attr("data-page"))})}else c.dom.find(".pagination-wrapper").css("visibility","hidden");c.dom.find(".list-wrapper .item").on("click",function(){if($(this).hasClass("selected"))c.add();else{c.selected=$(this).find("svg").first();var a=$.grep(c.list,function(a){return a.id==c.selected.parent().attr("svgid")})[0];2==a.status?(c.dom.find(".buttombar table").addClass("withedit"),c.editmode=!0):(c.dom.find(".buttombar table").removeClass("withedit"),c.editmode=!1),c.dom.find(".list-wrapper .item").removeClass("selected"),$(this).addClass("selected")}})}c.dom.find(".body .load").fadeOut("fast")})}},c.nextpage=function(){c.currentpage=parseInt(c.dom.find(".curpage").html())+1,"logo"==c.type?c.retrievelogos(c.currentpage,c.dom.find(".category-others ul.root li.selected").attr("catid")):c.retrieveshapes()},c.prevpage=function(){c.currentpage=parseInt(c.dom.find(".curpage").html())-1,"logo"==c.type?c.retrievelogos(c.currentpage,c.dom.find(".category-others ul.root li.selected").attr("catid")):c.retrieveshapes()},c.page=function(a){"logo"==c.type&&c.retrievelogos(a,c.dom.find(".category-others ul.root li.selected").attr("catid"))},c.retrieveshapes=function(){c.dom.find(".list-wrapper").empty(),c.dom.find(".body .load").show(),$.ajax({type:"post",url:c.drawningboard.api.shape+"list",data:JSON.stringify({page:c.currentpage,owner:c.owner.val(),status:c.status.val()}),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(a){"1"==a.status?(c.list=a.obj,c.list&&c.list.length&&$.each(c.list,function(a,b){var d=$(b.svg),e=$('<div class="item"></div>');e.attr("svgid",b.id);var f=Snap(d[0]);f.attr("viewBox")||f.attr({viewBox:"0 0 "+b.width+" "+b.height}),b.gradient=new Gradient,b.gradient.decode(b.color),f.selectAll("path, polygon, rect, circle").attr({fill:b.gradient.getsvgcolor(c.drawningboard.workspace)}),e.append(d),f.attr({"class":"thumb"}),c.dom.find(".list-wrapper").append(e)}),c.dom.find(".body .load").fadeOut("fast"),a.vars.pages>1?(c.dom.find(".totalpage").html(a.vars.pages),c.dom.find(".curpage").html(a.vars.curpage),c.dom.find(".pagination-wrapper").css("visibility","visible"),c.dom.find(".pagination-wrapper .next").unbind("mouseup"),c.dom.find(".pagination-wrapper .previous").unbind("mouseup"),a.vars.pages>a.vars.curpage?(c.dom.find(".pagination-wrapper .next").removeClass("disabled"),c.dom.find(".pagination-wrapper .next").on("mouseup",function(){c.nextpage()})):c.dom.find(".pagination-wrapper .next").addClass("disabled"),a.vars.curpage>1?(c.dom.find(".pagination-wrapper .previous").removeClass("disabled"),c.dom.find(".pagination-wrapper .previous").on("mouseup",function(){c.prevpage()})):c.dom.find(".pagination-wrapper .previous").addClass("disabled")):c.dom.find(".pagination-wrapper").css("visibility","hidden"),c.dom.find(".list-wrapper .item").on("click",function(){$(this).hasClass("selected")?c.add():(c.dom.find(".list-wrapper .item").removeClass("selected"),$(this).addClass("selected"),c.selected=$(this).find("svg"))})):"0"==a.status&&c.dom.find(".body .load").fadeOut("fast")})},c.showshapedialog=function(){c.dom.find(".title-name").html(c.drawningboard.api.dictionary.adddialog_shape_title),c.dom.find(".title .icon").attr("src","img/Add_Shape.svg"),c.retrieveshapes(),c.status.on("change",function(){c.currentpage=1,c.retrieveshapes()}),c.owner.on("change",function(){c.currentpage=1,c.retrieveshapes()})},c.add=function(){void 0!=c.selected&&("logo"==c.type?c.addlogo():"icon"==c.type?c.addicon():c.addshape())},c.addshape=function(){if(!c.adding){c.adding=!0;var a=c.selected[0],b=$.grep(c.list,function(a){return a.id==c.selected.parent().attr("svgid")})[0],d=b.gradient;if(c.drawningboard.clipid++,b.width>b.height)var e=b.width;else var e=b.height;var f=new Clip(a,d,c.drawningboard);f.scalex=200/e,f.scaley=200/e,f.id=c.drawningboard.clipid,f.start(),c.drawningboard.selector.setnewclipstate(f),c.drawningboard.selector.select([f],!0),c.drawningboard.selector.changed=1,c.drawningboard.selector.save(),c.drawningboard.selector.explodedmode&&c.drawningboard.selector.endexplodedmode(),c.hide()}},c.proccessaddlogo=function(a){if(a)var b=$.grep(c.list,function(b){return b.guid==a})[0];else var b=$.grep(c.list,function(a){return a.id==c.selected.parent().attr("svgid")})[0];b.dominant_color&&c.drawningboard.toolbar.setdominantcolor(b.dominant_color),b.background_color&&c.drawningboard.background.setcolor(b.background_color),c.drawningboard.plan=b.paid_item_number,c.drawningboard.clipid++;var d;$.each(b.shape_list,function(a,e){e.gradient||(e.gradient=new Gradient,e.gradient.decode(e.color)),d=new Clip($(e.svg)[0],e.gradient,c.drawningboard),d.note=e.note,d.x=e.offset_x/e.scale_x,d.y=e.offset_y/e.scale_y,d.id=c.drawningboard.clipid,d.offset.x=b.width/e.scale_x,d.offset.y=b.height/e.scale_y,d.scalex=e.scale_x,d.scaley=e.scale_y,d.rotation=parseInt(e.rotation),d.flipx=parseInt(e.flip_x),d.flipy=parseInt(e.flip_y),d.groupid=e.group_id,d.start(),c.drawningboard.selector.setnewclipstate(d),c.drawningboard.clipid++}),$.each(b.text_list,function(a,e){e.gradient||(e.gradient=new Gradient,e.gradient.decode(e.color));var f=JSON.parse(e.format),g=JSON.parse(e.curvedline);if(c.drawningboard.companyname&&"false"!=c.drawningboard.companyname){if("Company Name"==f.text.trim().replaceAll("  "," ").replaceAll("  "," "))partName=c.drawningboard.companyname;else{var h=c.drawningboard.companyname.indexOf(" ");if(h>0)var i=c.drawningboard.companyname.substring(0,h),j=c.drawningboard.companyname.substring(h+1);else var i=c.drawningboard.companyname,j="";partName="Company"==f.text.trim()?i:"Name"==f.text.trim()?j:f.text}f.text=partName}""!=f.text&&(d=new Text(f.text,f.font,0,e.gradient,c.drawningboard,0,0,c.drawningboard.clipid),d.x=e.offset_x/e.scale_x,d.y=e.offset_y/e.scale_y,d.format.bold=f.bold,d.format.italic=f.italic,f.alignment&&(d.format.alignment=f.alignment),d.offset.x=b.width/e.scale_x,d.offset.y=b.height/e.scale_y,d.rotation=e.rotation,d.flipx=parseInt(e.flip_x),d.flipy=parseInt(e.flip_y),d.scalex=e.scale_x,d.scaley=e.scale_y,d.width=e.width,d.height=e.height,d.curvedline.enabled=g.enabled,d.curvedline.left.x=g.left.x,d.curvedline.left.y=g.left.y,d.curvedline.anchorleft.x=g.anchorleft.x,d.curvedline.anchorleft.y=g.anchorleft.y,d.curvedline.anchorright.x=g.anchorright.x,d.curvedline.anchorright.y=g.anchorright.y,d.curvedline.startheight=g.startheight,d.curvedline.startwidth=g.startwidth,d.curvedline.right.x=g.right.x,d.curvedline.right.y=g.right.y,d.curvedline.type=g.type,d.groupid=e.group_id,d.start(),c.drawningboard.selector.setnewclipstate(d),c.drawningboard.clipid++)}),c.drawningboard.icon&&c.drawningboard.firstdisplay&&(c.drawningboard.firstdisplay=!1,"preview"==c.drawningboard.mode&&(c.drawningboard.isSave=!0,c.drawningboard.flowtab.preview())),c.drawningboard.selector.refreshindex(),c.drawningboard.selector.settarget(c.drawningboard.cliplist),c.drawningboard.selector.select(c.drawningboard.cliplist,!0);var e=c.drawningboard.selector.getclipdata(c.drawningboard.selector.target);if(e.width>c.drawningboard.width||e.height>c.drawningboard.height){var f=c.drawningboard.width/e.width,g=c.drawningboard.height/e.height,h=1;h=g>f?f:g,c.drawningboard.selector.setscale(h,h),c.drawningboard.selector.contextaction=!0,c.drawningboard.selector.contextrelease()}c.drawningboard.selector.changed=1,c.drawningboard.selector.save(),c.drawningboard.selector.unselect(),c.hide()},c.okediticon=function(){c.drawningboard.reset(),c.hide(),setTimeout(function(){c.adding=!1,c.drawningboard.editiconid=c.selected.parent().attr("svgid"),c.proccessaddlogo()},500)},c.canceleditcon=function(){c.adding=!1,c.drawningboard.editiconid=void 0},c.addlogo=function(){c.adding||(c.adding=!0,c.proccessaddlogo())},c.editicon=function(){if(!c.adding){c.adding=!0;var a=new Messagebox(c.drawningboard,c.drawningboard.api.dictionary.adddialog_icon_edit_message,c.okediticon,c.drawningboard.api.dictionary.ok,c.drawningboard.api.dictionary.cancel,c.canceleditcon);return void a.show()}}};