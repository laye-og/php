Toolbar=function(a){var b=this;b.dom,b.drawningboard=a,b.bgpicker,b.dominantpicker,b.enabled=!0,b.uploadnote,b.addicondialog,b.save,b.start=function(){b.drawningboard.api.loadTemplate("toolbar",function(a){b.dom=$("#toolbar"),b.dom.append($(a)),b.bgpicker=$(".background-picker"),b.dominantpicker=$(".dominant-picker"),b.languagepicker=$(".toolbar-language-select"),b.save=b.dom.find(".confirm"),b.save.on("click",function(){b.drawningboard.isSave=!0,b.drawningboard.flowtab.preview()}),b.drawningboard.formatsvg(b.dom),b.bgpicker.colpick({backgroundPicker:!0,id:"bg",onUseBackground:function(a){b.drawningboard.showbackground=a},onChange:function(a,c,d,e,f){$(f).find(".colorpicker").css("background-color","rgba("+e.r+","+e.g+","+e.b+","+e.a+")"),b.drawningboard.background&&(b.drawningboard.background.color.colorlist[0].color="rgba("+e.r+","+e.g+","+e.b+","+e.a+")",b.drawningboard.background.update())},onSubmit:function(){b.drawningboard.selector.changed=1,b.drawningboard.background.update(),b.drawningboard.selector.save()},onHide:function(){b.drawningboard.selector.changed=1,b.drawningboard.background.update(),b.drawningboard.selector.save()}}).colpickSetOriginal($.colpick.stringToRgba("rgba(255, 255, 255, 0.25)")).colpickSetColor($.colpick.stringToRgba("rgba(255, 255, 255, 0.25)")),b.dominantpicker.colpick({id:"dominant",onChange:function(a,c,d,e,f){$(f).find(".colorpicker").css("background-color","rgba("+e.r+","+e.g+","+e.b+","+e.a+")"),b.drawningboard.dominantcolor="rgba("+e.r+","+e.g+","+e.b+","+e.a+")"},onSubmit:function(){b.drawningboard.selector.changed=1,b.drawningboard.background.update(),b.drawningboard.selector.save()},onHide:function(){b.drawningboard.selector.changed=1,b.drawningboard.background.update(),b.drawningboard.selector.save()}}).colpickSetOriginal($.colpick.stringToRgba(b.dominantpicker.find(".colorpicker").css("background-color"))),b.registerevents()})},b.setdominantcolor=function(a){b.dominantpicker.colpickSetColor($.colpick.stringToRgba(a))},b.disable=function(){b.dom.addClass("disabled"),b.enabled=!1},b.enable=function(){b.dom.removeClass("disabled"),b.enabled=!0},b.finish=function(){b.dom.empty()},b.drawinitialelements=function(){b.addlogo()},b.addtext=function(){b.drawningboard.selector.explodedmode&&b.drawningboard.selector.endexplodedmode();var a=new Gradient;a.colorlist.push(new Color("rgba(0, 0, 0, 1)")),b.drawningboard.clipid++,text=new Text("New Text","Amarante",.5,a,b.drawningboard,null,null,b.drawningboard.clipid),text.start(),b.setnewclipstate(text),setTimeout(function(){b.drawningboard.contexttab.focustextinput()},500),b.drawningboard.selector.select([text],!0),b.drawningboard.selector.changed=1,b.drawningboard.selector.save(),b.drawningboard.selector.explodedmode&&b.drawningboard.selector.endexplodedmode()},b.addshape=function(){b.drawningboard.selector.explodedmode&&b.drawningboard.selector.endexplodedmode();var a=new AddDialog(b.drawningboard,"shape");a.show()},b.addlogo=function(){b.drawningboard.selector.explodedmode&&b.drawningboard.selector.endexplodedmode();var a=new AddDialog(b.drawningboard,"logo");a.show()},b.addicon=function(){b.drawningboard.selector.explodedmode&&b.drawningboard.selector.endexplodedmode(),b.addicondialog?b.addicondialog.back():(b.addicondialog=new AddDialog(b.drawningboard,"icon"),b.addicondialog.show())},b.addsvg=function(){$("#admin-upload").click()},b.inserttext=function(a,c,d,e,f,g,h,i,j,k){return clip1=new Text(a,c,i,h,b.drawningboard,d,e,b.drawningboard.clipid),clip1.format.size=j,clip1.offset.x=f,clip1.offset.y=g,clip1.subid=k,clip1.start(),b.drawningboard.selector.setnewclipstate(clip1),clip1},b.insertclip=function(a,c,d,e,f,g,h,i,j){return clip1=new Clip(a[0],g,b.drawningboard,c,d,b.drawningboard.clipid,i,null,e,f,h),clip1.note=j,clip1.start(),b.drawningboard.selector.setnewclipstate(clip1),b.drawningboard.clipid++,clip1},b.startownermode=function(){(b.drawningboard.fullaccess||2==b.drawningboard.rights)&&(b.dom.find(".reviewlogo").show(),b.dom.find(".addsvg").show()),b.bgpicker.hide()},b.reviewicon=function(){var a=new ReviewDialog(b.drawningboard);a.show()},b.getparentbox=function(a){var c=$(a).parent(),d=Snap(c[0]),e=d.getBBox();if(e){if(c.attr("transform"))var f=e.cx,g=e.cy;else var f=0,g=0;if(c.attr("opacity"))var h=parseFloat(c.attr("opacity"));else var h=1;if(c.parent()[0]&&"[object SVGGElement]"==c.parent()[0].toString()){var i=b.getparentbox(c[0]);i&&(f+=i.cx,g+=i.cy,h*=i.opacity)}}else f=0,g=0;return{opacity:h,cx:f,cy:g}},b.getColor=function(a,b,c){var d=new Gradient,e=$(a).attr("fill");if(e||(e=$(a).css("fill")),e)if("none"==e)e="rgba(255,255,255,0)",d.colorlist.push(new Color(e));else if(0==e.indexOf("url(")){var f=e.replace("url(","").replace(")","");f=f.replace(document.URL,""),f=f.replace("'","").replace("'",""),f=f.replace('"',"").replace('"',""),f=f.replace("transparent",""),f=f.replace(" ","");var g=$(c).find(f);if("[object SVGRadialGradientElement]"==g[0].toString())e="#000000",d.colorlist.push(new Color(e));else{var h=g.attr("x1"),i=g.attr("y1"),j=g.attr("x2"),k=g.attr("y2"),l=calc.getAngleOfPoints(h,i,j,k);if(d.rotation=parseInt(l),g.attr("xlink:href"))var m=$(c).find(g.attr("xlink:href")),n=m.find("stop");else var n=g.find("stop");$.each(n,function(a,c){var e=$(c).css("stop-opacity");e||(e=1),e*=b.opacity;var f=new Color($(c).css("stop-color"),e);f.position=100*parseFloat($(c).attr("offset")),d.colorlist.push(f)})}}else d.colorlist.push(new Color(e,b.opacity));else e="#000000",d.colorlist.push(new Color(e,b.opacity));return d},b.proccesssvg=function(a,c){var d=$(a);$.each(d,function(a,d){var e=d;if($("body").append(e),"[object SVGSVGElement]"==d.toString()){if("100%"!=$(d).attr("width")&&$(d).attr("width"))var f=parseInt($(d).attr("width"))+10;else var f=300;if("100%"!=$(d).attr("height")&&$(d).attr("height"))var g=parseInt($(d).attr("height"))+10;else var g=300;var h=($(d).find("defs").clone(),f>g?g:f),i=300/h;$(d).find("#Captions").remove(),$(d).find("#Polka_Dot_Pattern").remove(),$(d).find("marker").remove(),$.each($(d).find("path, polygon, circle, rect, ellipse"),function(a,d){var h=b.getparentbox(d);if("[object SVGClipPathElement]"!=$(d).parent()[0].toString()){var j=$(d).parent().attr("fill-rule");j&&$(d).attr("fill-rule",j);var k=$("<svg width='"+f+"' height='"+g+"'></svg>"),l=Snap(k[0]);l.add(d.cloneNode(!0));var m=l.selectAll("path, polygon, circle, rect, ellipse").getBBox();l.attr({viewBox:""+(m.x-5)+","+(m.y-5)+","+(m.width+10)+","+(m.height+10),width:m.width+10,height:m.height+10});var n=b.getColor(d,h,e),o=m.cx,p=m.cy,q=b.insertclip($(k),o,p,f,g,n,i,void 0,b.uploadnote);q.nounId=c,b.drawningboard.selector.target.push(q)}}),$.each($(d).find("text, tspan"),function(a,c){var d=b.getparentbox(c);if("[object SVGClipPathElement]"!=$(c).parent()[0].toString()&&"[object SVGTextElement]"!=$(c).parent()[0].toString()){var h=$("<svg width='"+f+"' height='"+g+"'></svg>"),j=Snap(h[0]);j.add(c.cloneNode(!0));var k=b.getColor(c,d,e),l=$(c).attr("font-family");l||(l=$(c).css("font-family")),l||(l="Amarante");var m=$(c).text();$(m)[0]&&"TSPAN"==$(m)[0].tagName&&(m=$(m).text());var n=c.getBBox(),o=n.x+n.width/2,p=n.y+n.height/2,q=$(c).attr("font-size");if(!q)var q=$(c).css("font-size");var r=$(c).attr("transform");if(r){if(r.indexOf(",")>0)var s=",";else if(r.indexOf(" ")>0)var s=" ";transformArray=r.slice(7,-1).split(s);{parseFloat(transformArray[1]),parseFloat(transformArray[2])}}q=parseInt(q);var t=b.inserttext(m,l,o,p,f,g,k,i,q,subidindex);subidindex++,b.drawningboard.selector.target.push(t)}}),$(e).remove()}});var e=b.drawningboard.selector.target;b.drawningboard.selector.changed=1,b.drawningboard.selector.save(),b.drawningboard.selector.select(e,!0),b.drawningboard.selector.center(),setTimeout(function(){b.drawningboard.selector.refreshindex(),b.drawningboard.selector.unselect(),b.drawningboard.selector.select(e,!0),b.drawningboard.selector.center(),b.drawningboard.selector.unselect()},1),b.dom.find("#admin-upload").wrap("<form>").closest("form").get(0).reset(),b.dom.find("#admin-upload").unwrap()},b.uploadsvg=function(a){var c=prompt("Please enter the note:");b.uploadnote=null!=c&&""!=c?c:void 0,b.drawningboard.clipid++,b.drawningboard.selector.target=[],$.each(a,function(a,c){var d=new FileReader;d.onload=function(){return function(a){var c=a.target.result;b.proccesssvg(c)}}(c),d.readAsText(c)})},b.changelanguage=function(){var a=b.languagepicker.find("select").val();b.drawningboard.startloading(),b.drawningboard.api.setLanguage(a,function(){b.drawningboard.api.fillTemplateLanguage($("body")),setTimeout(function(){b.drawningboard.endloading()},300)},!0)},b.uploaddialog=function(a){b.uploadsvg(a.target.files)},b.registerevents=function(){b.dom.find(".addtext").on("click",b.addtext),b.dom.find(".addshape").on("click",b.addshape),b.dom.find(".addlogo").on("click",b.addlogo),b.dom.find(".addicon").on("click",b.addicon),b.dom.find(".addsvg").on("click",b.addsvg),b.dom.find("#admin-upload").on("change",b.uploaddialog),b.dom.find(".reviewlogo").on("click",b.reviewicon);var a=b.languagepicker.find("select");a.on("change",b.changelanguage),b.drawningboard.api.getLanguageList(function(c){$.each(c,function(b,c){a.append("<option value="+c.code+">"+c.code+"</option>")}),a.val(b.drawningboard.api.language)})},b.setnewclipstate=function(a){b.drawningboard.selector.setnewclipstate(a)},b.start()};