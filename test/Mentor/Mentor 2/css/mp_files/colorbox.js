Colorbox=function(a,b,c,d){var e=this;e.tab=a,e.dom=$('<div class="color-picker"><div class="color-picker-color"></div></div>'),e.colordom=e.dom.find(".color-picker-color"),e.context=b,e.color=c,e.originalcolor,e.dragging=!1,e.isgradient=d,e.target=e.tab.target,e.autoopen=!1,e.event,e.delete=function(){$.each(e.tab.color.colorlist,function(a){return e.tab.color.colorlist[a]==e.color?(e.tab.color.colorlist.splice(a,1),!1):void 0}),e.tab.updatecolor(),e.tab.updatepreview(),e.tab.drawningboard.selector.changed=1,e.tab.drawningboard.selector.save(),1==e.tab.color.colorlist.length&&e.tab.select([e.target]),e.colordom.parent().remove(),e.tab.drawningboard.isFirefox&&e.tab.drawningboard.selector.refreshindex()},e.start=function(){e.originalcolor=e.color.color?e.color.color.replaceAll(" ",""):void 0,e.context.prepend(e.dom),e.color.color?e.colordom.css("background-color",e.color.color):e.colordom.parent().css("background-image","url('img/bgempty.png')"),e.dom.css("left",2.11*e.color.position);var a=e.colordom.colpick({showdelete:d,onChange:function(a,b,c,d,f){e.colordom.parent().css("background-image","url('img/bg.png')"),$(f).css("background-color","rgba("+d.r+","+d.g+","+d.b+","+d.a+")"),d?(e.color.color="rgba("+d.r+","+d.g+","+d.b+","+d.a+")",e.tab.updatecolor(),e.tab.updatepreview()):e.color.color=void 0,e.tab.drawningboard.isFirefox&&e.tab.drawningboard.selector.refreshindex()},onSubmit:function(){e.color.color!=e.originalcolor&&void 0!=e.color.color&&(e.originalcolor=e.color.color.replaceAll(" ",""),e.tab.drawningboard.selector.changed=1,e.tab.drawningboard.selector.save())},onHide:function(){e.color.color!=e.originalcolor&&void 0!=e.color.color&&(e.originalcolor=e.color.color.replaceAll(" ",""),e.tab.drawningboard.selector.changed=1,e.tab.drawningboard.selector.save())},onDelete:function(a,b){e.delete(),$(b).remove()},onBeforeShow:function(a){e.tab.currentpanel.find(".textbox input").blur(),e.dragging?(a.dragging=!0,e.dragging=!1):a.dragging=!1}});a.colpickSetOriginal(e.color.color?$.colpick.stringToRgba(e.color.color):void 0),e.isgradient&&(e.dom.draggable({containment:"parent"}),e.dom.on("drag",function(a,b){var c=b.position.left/211*100,d=b.position.top-10;0>c&&(c=0),c>100&&(c=100),d>20||-40>d?e.dom.css("opacity",.3):e.dom.css("opacity",1),e.color.position=c,e.tab.updatecolor(),e.tab.updatepreview(),e.dragging=!0,e.tab.drawningboard.isFirefox&&e.tab.drawningboard.selector.refreshindex()}),e.dom.on("dragstop",function(a,b){e.tab.drawningboard.selector.changed=1,e.tab.drawningboard.selector.save();var c=b.position.top-10;c>20||-40>c?e.dom.animate({opacity:0},"fast",function(){e.delete()}):e.dom.animate({top:10},"fast"),setTimeout(function(){e.dragging=!1},50)}),e.dom.on("dragstart",function(a){if(a.ctrlKey){var b=new Color(e.color.color);b.position=e.color.position,e.tab.color.colorlist.push(b);var c=new Colorbox(e.tab,e.tab.currentpanel.find(".multiple-track"),b,!0);c.start()}})),e.dom.on("contextmenu",function(){return!1}),e.autoopen&&setTimeout(function(){e.colordom.trigger("click")},100)}};