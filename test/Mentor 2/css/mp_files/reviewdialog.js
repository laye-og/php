ReviewDialog=function(a){var b=this;b.drawningboard=a,b.dom,b.category,b.status,b.owner,b.search,b.category_select1,b.category_select2,b.category_select3,b.status_select,b.owner_select,b.objownerlist,b.objcategorylist,b.objiconlist,b.edit,b.exit,b.close,b.next,b.save,b.currentpage=1,b.show=function(){b.drawningboard.api.loadTemplate("reviewdialog",function(a){b.dom=$(a),$("#logobody").append(b.dom),b.dom.hide(),b.dom.fadeIn(200),b.drawningboard.messagemenu=b,b.category=b.dom.find(".selection-menu .category select"),b.status=b.dom.find(".selection-menu .status select"),b.owner=b.dom.find(".selection-menu .owner select"),b.search=b.dom.find(".selection-menu .search"),b.exit=b.dom.find(".selection-menu .close"),b.category_select1=b.dom.find(".lateral-menu .category-1 select"),b.category_select2=b.dom.find(".lateral-menu .category-2 select"),b.category_select3=b.dom.find(".lateral-menu .category-3 select"),b.status_select=b.dom.find(".lateral-menu .status select"),b.owner_select=b.dom.find(".lateral-menu .owner select"),b.edit=b.dom.find(".lateral-menu .buttons .edit"),b.close=b.dom.find(".lateral-menu .buttons .close"),b.next=b.dom.find(".lateral-menu .buttons .next"),b.save=b.dom.find(".lateral-menu .buttons .save"),b.wrapper=b.dom.find(".body .list .list-wrapper"),b.load=b.dom.find(".body .load"),b.registerevents(),b.loadowners(),b.loadcategories(),b.startsearch()})},b.loadowners=function(){$.ajax({type:"post",url:b.drawningboard.api.owner+"list",dataType:"json"}).done(function(a){b.objownerlist=a.obj,$.each(b.objownerlist,function(a,c){var d=$("<option>"+c.key+"</option>"),e=$("<option>"+c.key+"</option>");d.attr("value",c.id),e.attr("value",c.id),b.owner.append(d),b.owner_select.append(e)})}).fail(function(){b.requesterror()})},b.requesterror=function(){if(!b.category_select1.val()&&!b.category_select2.val()&&!b.category_select3.val()){var a=new Messagebox(b.drawningboard,"Error requesting information from the server, please try again.",null,null,"ok",b.hide);return void a.show()}},b.loadcategories=function(){$.ajax({type:"post",url:b.drawningboard.api.category+"list",data:JSON.stringify({status:b.status.val(),owner:b.owner.val()}),dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(a){b.category.find("option").remove();var c=b.category.val(),d=b.category_select1.val(),e=b.category_select2.val(),f=b.category_select3.val();b.category_select1.find("option").remove(),b.category_select2.find("option").remove(),b.category_select3.find("option").remove();var g=$("<option>All</option>"),h=$("<option></option>");if(g.attr("value",0),b.category.append(g),b.category_select1.append(h),b.category_select2.append(h.clone()),b.category_select3.append(h.clone()),a.obj&&a.obj.length>0){$.each(a.obj,function(a,c){c.description=b.drawningboard.api.dictionary["category_"+c.id],void 0==c.description&&(c.description="undefined")});var i=a.obj;i.sort(function(a,b){return a.description.toUpperCase()>b.description.toUpperCase()?1:a.description<b.description?-1:void 0}),console.log(i),b.objcategorylist=i,$.each(b.objcategorylist,function(a,c){var d=$("<option>"+c.description+" ("+c.qtd+")</option>"),e=$("<option>"+c.description+"</option>");d.attr("value",c.id),e.attr("value",c.id),c.qtd>0&&b.category.append(d),b.category_select1.append(e),b.category_select2.append(e.clone()),b.category_select3.append(e.clone()),c.subcategory&&$.each(c.subcategory,function(a,c){var d=$("<option>- "+c.description+" ("+c.qtd+")</option>"),e=$("<option>- "+c.description+"</option>");d.attr("value",c.id),e.attr("value",c.id),c.qtd>0&&b.category.append(d),b.category_select1.append(e),b.category_select2.append(e.clone()),b.category_select3.append(e.clone())})})}b.category.val(c),b.category_select1.val(d),b.category_select2.val(e),b.category_select3.val(f)}).fail(function(){b.requesterror()})},b.startsearch=function(){b.closeedit(),b.load.fadeIn("fast"),b.category_select1.val(""),b.category_select2.val(""),b.category_select3.val(""),b.category_select1.tooltip({content:""}),b.category_select2.tooltip({content:""}),b.category_select3.tooltip({content:""}),b.status_select.val(""),b.owner_select.val(""),$.ajax({type:"post",url:b.drawningboard.api.logo+"list",data:JSON.stringify({page:b.currentpage,category:b.category.val(),owner:b.owner.val(),status:b.status.val(),pagesize:18}),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(a){if(b.wrapper.empty(),a.vars.pages>1?(b.dom.find(".totalpage").html(a.vars.pages),b.dom.find(".curpage").html(a.vars.curpage),b.dom.find(".pagination-wrapper").css("visibility","visible"),b.dom.find(".pagination-wrapper .next").unbind("mouseup"),b.dom.find(".pagination-wrapper .previous").unbind("mouseup"),a.vars.pages>a.vars.curpage?(b.dom.find(".pagination-wrapper .next").removeClass("disabled"),b.dom.find(".pagination-wrapper .next").on("mouseup",function(){b.nextpage()})):b.dom.find(".pagination-wrapper .next").addClass("disabled"),a.vars.curpage>1?(b.dom.find(".pagination-wrapper .previous").removeClass("disabled"),b.dom.find(".pagination-wrapper .previous").on("mouseup",function(){b.prevpage()})):b.dom.find(".pagination-wrapper .previous").addClass("disabled")):b.dom.find(".pagination-wrapper").css("visibility","hidden"),a.obj){b.objiconlist=a.obj,$.each(b.objiconlist,function(a,c){var d=$('<div class="item"></div>'),e=getthumb(c);d.append(e.svg),d.attr("svgid",c.id),b.wrapper.append(d)});var c=b.dom.find(".list .item");c.on("mouseup",function(){if($(this).hasClass("selected"))b.openedit();else{b.closeedit(),c.removeClass("selected"),$(this).addClass("selected");var a=$(".lateral-menu .id span"),d=$(this).attr("svgid");a.html("ID "+d);var e=$.grep(b.objiconlist,function(a){return a.id==d})[0];b.status_select.val(e.status),b.owner_select.val(e.owner_id);var f=[];$.each(e.shape_list,function(a,b){-1==f.indexOf(b.note)&&f.push(b.note)});var g="";$.each(f,function(a,b){g+=b+" "}),g.trim()?($(".lateral-menu .id .fa").attr("title",g),$(".lateral-menu .id .fa").show()):$(".lateral-menu .id .fa").hide();var h=1;e.category_list&&$.each(e.category_list,function(a,b){var c=$(".lateral-menu .category-"+h+" select");c.val(b.id),c.tooltip({content:c.find(":selected").text()}),h++})}})}b.load.fadeOut("fast")}).fail(function(){b.requesterror()})},b.nextpage=function(){b.currentpage=parseInt(b.dom.find(".curpage").html())+1,b.startsearch()},b.prevpage=function(){b.currentpage=parseInt(b.dom.find(".curpage").html())-1,b.startsearch()},b.nextedit=function(){if(!b.category_select1.val()&&!b.category_select2.val()&&!b.category_select3.val()){var a=new Messagebox(b.drawningboard,"You can't save without choosing a category.",null,null,"ok");return void a.show()}if(!b.status_select.val()){var a=new Messagebox(b.drawningboard,"You can't save without choosing a status.",null,null,"ok");return void a.show()}b.load.fadeIn("fast"),$.ajax({type:"post",url:b.drawningboard.api.logo+"update",data:JSON.stringify(b.getsaveenvelope()),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(){b.load.fadeOut("fast"),b.dom.find(".msgbox").css("opacity",1),setTimeout(function(){b.dom.find(".msgbox").css("opacity",0)},2e3),b.nexticon[0]&&(b.nexticon.trigger("mouseup"),b.nexticon.trigger("mouseup"))}).fail(function(){b.requesterror()}),b.closeedit()},b.getsaveenvelope=function(){var a=$(".list .item.selected"),c=a.attr("svgid"),d={};d.id=c,d.owner_id=b.owner_select.val(),d.status=b.status_select.val(),d.category_list=[],b.category_select1.val()&&d.category_list.push({id:b.category_select1.val()}),b.category_select2.val()&&d.category_list.push({id:b.category_select2.val()}),b.category_select3.val()&&d.category_list.push({id:b.category_select3.val()});var e={logo:d,loginKey:b.drawningboard.ownerloginkey};return e},b.saveedit=function(){if(!b.category_select1.val()&&!b.category_select2.val()&&!b.category_select3.val()){var a=new Messagebox(b.drawningboard,"You can't save without choosing a category.",null,null,"ok");return void a.show()}if(!b.status_select.val()){var a=new Messagebox(b.drawningboard,"You can't save without choosing a status.",null,null,"ok");return void a.show()}b.load.fadeIn("fast"),$.ajax({type:"post",url:b.drawningboard.api.logo+"update",data:JSON.stringify(b.getsaveenvelope()),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(){b.closeedit(),b.loadcategories(),b.startsearch()}).fail(function(){b.requesterror()})},b.submitedit=function(){},b.rollbackedit=function(){b.closeedit(),b.loadcategories(),b.startsearch()},b.closeedit=function(){$(".lateral-menu .id span").html("ID "),$(".lateral-menu .id .fa").hide(),$(".lateral-menu .buttons .disabled").removeClass("disabled"),b.next.addClass("disabled"),b.close.addClass("disabled"),b.save.addClass("disabled"),$(".list .item").removeClass("selected"),b.category_select1.val(""),b.category_select2.val(""),b.category_select3.val(""),b.status_select.val(""),b.owner_select.val(""),$(".lateral-menu .lateral-container .fa").hide(),$(".lateral-menu .lateral-container select").attr("disabled","disabled");var a=$(".body .item-detail");a.remove(),$(".review-window .body .list").show(),$(".review-window .body .pagination").show()},b.openedit=function(){var a=$(".list .item.selected");if(a[0]){b.nexticon=a.next(),$(".lateral-menu .buttons .disabled").removeClass("disabled"),b.edit.addClass("disabled"),$(".lateral-menu .lateral-container select").removeAttr("disabled"),$(".lateral-menu .lateral-container .fa").show(),b.nexticon[0]?b.next.removeClass("disabled"):b.next.addClass("disabled");var c=$("<div class='item-detail'></div>"),d=a.attr("svgid"),e=$.grep(b.objiconlist,function(a){return a.id==d})[0],f=getthumb(e);c.append(f.svg),c.find(".thumb").css("width","90%"),c.find(".thumb").css("height","90%"),c.find(".thumb").css("margin","21px"),$(".review-window .body").append(c),$(".review-window .body .list").hide(),$(".review-window .body .pagination").hide()}},b.registerevents=function(){b.exit.on("mouseup",function(){b.hide()}),b.category.on("change",function(){b.currentpage=1,b.startsearch()}),b.dom.find(".lateral-menu select").on("change",function(){$(this).tooltip({content:$(this).find(":selected").text()})}),b.status.on("change",function(){b.currentpage=1,b.loadcategories(),b.startsearch()}),b.owner.on("change",function(){b.currentpage=1,b.loadcategories(),b.startsearch()}),b.edit.on("mouseup",function(){b.openedit()}),b.close.on("mouseup",function(){b.rollbackedit()}),b.save.on("mouseup",function(){b.saveedit()}),b.next.on("mouseup",function(){b.nextedit()}),b.dom.find(".lateral-menu .category-1 .fa").on("click",function(){b.category_select1.val(0)}),b.dom.find(".lateral-menu .category-2 .fa").on("click",function(){b.category_select2.val(0)}),b.dom.find(".lateral-menu .category-3 .fa").on("click",function(){b.category_select3.val(0)})},b.hide=function(){b.dom.fadeOut(200,function(){b.dom.remove(),b.drawningboard.messagemenu=void 0})}};